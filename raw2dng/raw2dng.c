/*
 * Copyright (C) 2013 Magic Lantern Team
 * 
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License
 * as published by the Free Software Foundation; either version 2
 * of the License, or (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the
 * Free Software Foundation, Inc.,
 * 51 Franklin Street, Fifth Floor,
 * Boston, MA  02110-1301, USA.
 */

#include "stdint.h"
#include "stdio.h"
#include "stdlib.h"
#include "string.h"
#include "math.h"
#include "raw.h"
#include "chdk-dng.h"
#include "cmdoptions.h"
#include "patternnoise.h"
#include "metadata.h"

/* these LUTs should make the sensor response linear */
/* they also multiply the input values by 8, to reduce roundoff errors */
/* TODO: they should probably be computed for each individual camera, and placed in a data file */
/* TODO: also cover values below the black level, since the noise is no longer symmetrical after applying these LUTs */
const uint16_t Lut_R [] = { 0,17,34,51,69,82,96,110,125,139,153,168,176,184,193,201,209,217,226,234,242,251,258,265,272,280,287,294,301,309,316,323,330,338,345,352,359,369,379,389,400,410,420,430,440,450,460,470,480,490,497,504,510,517,523,530,537,543,550,557,563,570,577,583,590,597,603,610,617,623,630,637,643,650,657,664,672,679,686,693,701,708,715,722,730,737,744,751,759,766,773,780,788,795,802,809,817,824,831,838,848,857,867,877,886,896,905,915,925,934,944,953,963,972,982,992,1001,1011,1020,1030,1037,1044,1051,1058,1065,1073,1080,1087,1094,1101,1108,1115,1122,1129,1137,1144,1151,1158,1165,1172,1179,1186,1193,1201,1208,1215,1222,1229,1236,1243,1250,1257,1264,1271,1278,1285,1291,1298,1305,1312,1319,1326,1333,1340,1346,1353,1360,1367,1374,1381,1388,1394,1401,1408,1415,1422,1429,1436,1443,1449,1456,1463,1470,1477,1484,1491,1497,1504,1511,1518,1525,1532,1540,1547,1555,1562,1570,1577,1585,1592,1599,1607,1614,1622,1629,1637,1644,1652,1659,1667,1674,1681,1689,1696,1704,1711,1719,1726,1734,1741,1748,1756,1763,1771,1778,1786,1793,1801,1808,1816,1823,1830,1837,1844,1852,1859,1866,1873,1881,1888,1895,1902,1910,1917,1924,1931,1939,1946,1953,1960,1968,1975,1982,1989,1997,2004,2011,2018,2025,2033,2040,2047,2054,2062,2069,2076,2083,2091,2098,2105,2112,2120,2127,2134,2141,2148,2156,2163,2170,2177,2184,2191,2199,2206,2213,2220,2227,2234,2242,2249,2256,2263,2270,2277,2285,2292,2299,2306,2313,2320,2328,2335,2342,2349,2356,2363,2371,2378,2385,2392,2399,2406,2414,2421,2428,2435,2442,2450,2457,2464,2471,2478,2485,2492,2499,2506,2513,2520,2527,2534,2541,2548,2555,2562,2569,2576,2583,2590,2597,2604,2611,2618,2625,2632,2639,2647,2654,2661,2668,2675,2682,2689,2696,2703,2710,2717,2724,2731,2738,2745,2752,2759,2766,2773,2780,2787,2794,2801,2808,2815,2822,2829,2836,2843,2850,2857,2864,2871,2878,2885,2892,2898,2905,2912,2919,2926,2933,2940,2947,2954,2960,2967,2974,2981,2988,2995,3002,3009,3016,3022,3029,3036,3043,3050,3057,3064,3071,3078,3084,3091,3098,3105,3112,3119,3126,3133,3139,3146,3153,3160,3167,3174,3181,3188,3195,3201,3208,3215,3222,3229,3236,3243,3250,3257,3263,3270,3277,3284,3291,3298,3304,3311,3318,3325,3331,3338,3345,3352,3358,3365,3372,3378,3385,3392,3399,3405,3412,3419,3426,3432,3439,3446,3453,3459,3466,3473,3479,3486,3493,3500,3506,3513,3520,3527,3533,3540,3547,3553,3560,3567,3574,3580,3587,3594,3601,3607,3614,3621,3628,3634,3641,3648,3654,3661,3668,3675,3681,3688,3695,3702,3708,3715,3722,3729,3735,3742,3749,3756,3762,3769,3776,3783,3789,3796,3803,3810,3817,3823,3830,3837,3844,3850,3857,3864,3871,3878,3884,3891,3898,3905,3911,3918,3925,3932,3939,3945,3952,3959,3966,3972,3979,3986,3993,3999,4006,4013,4020,4027,4033,4040,4047,4054,4060,4067,4074,4081,4088,4094,4101,4108,4115,4121,4128,4135,4142,4149,4155,4162,4169,4176,4183,4190,4197,4204,4211,4219,4226,4233,4240,4247,4254,4262,4269,4276,4283,4290,4297,4305,4312,4319,4326,4333,4340,4347,4355,4362,4369,4376,4383,4390,4398,4405,4412,4419,4426,4433,4441,4448,4455,4462,4469,4476,4484,4491,4498,4505,4512,4519,4527,4534,4541,4548,4555,4562,4569,4577,4584,4591,4598,4605,4612,4620,4627,4634,4641,4648,4655,4662,4669,4676,4683,4690,4697,4704,4711,4718,4725,4732,4739,4746,4753,4760,4767,4774,4781,4788,4795,4802,4809,4816,4823,4830,4837,4844,4851,4858,4865,4872,4879,4886,4893,4900,4907,4914,4921,4928,4935,4942,4949,4956,4963,4970,4977,4984,4991,4998,5005,5012,5019,5025,5032,5039,5046,5053,5060,5067,5074,5081,5088,5095,5103,5111,5119,5126,5134,5142,5150,5157,5165,5173,5180,5188,5196,5204,5211,5219,5227,5235,5242,5250,5258,5266,5273,5281,5289,5296,5304,5312,5320,5327,5335,5343,5351,5358,5366,5374,5382,5389,5397,5405,5412,5420,5428,5436,5443,5451,5459,5467,5474,5482,5490,5498,5505,5513,5521,5528,5536,5544,5552,5559,5567,5575,5583,5590,5596,5603,5609,5615,5621,5627,5633,5639,5645,5651,5657,5663,5670,5676,5682,5688,5694,5700,5706,5712,5718,5724,5731,5737,5743,5749,5755,5761,5767,5773,5779,5785,5791,5798,5804,5810,5816,5822,5828,5834,5840,5846,5852,5858,5865,5871,5877,5883,5889,5895,5901,5907,5913,5919,5925,5932,5938,5944,5950,5956,5962,5968,5974,5980,5986,5993,5999,6005,6011,6017,6023,6029,6035,6041,6047,6053,6059,6064,6070,6075,6081,6086,6091,6097,6102,6108,6113,6118,6124,6129,6135,6140,6146,6151,6156,6162,6167,6173,6178,6184,6189,6194,6200,6205,6211,6216,6221,6227,6232,6238,6243,6249,6254,6259,6265,6270,6276,6281,6287,6292,6297,6303,6308,6314,6319,6324,6330,6335,6341,6346,6352,6357,6362,6368,6373,6379,6384,6389,6395,6400,6406,6411,6417,6422,6427,6433,6438,6444,6449,6455,6460,6465,6471,6476,6482,6487,6492,6498,6503,6509,6514,6520,6525,6530,6536,6541,6547,6552,6558,6563,6568,6574,6579,6585,6590,6595,6601,6606,6612,6617,6623,6628,6633,6639,6644,6653,6661,6669,6677,6686,6694,6702,6711,6719,6727,6736,6744,6752,6760,6769,6777,6785,6794,6802,6810,6819,6827,6835,6843,6852,6860,6868,6877,6885,6893,6902,6910,6918,6926,6935,6943,6951,6960,6968,6976,6984,6993,7001,7009,7018,7026,7034,7043,7051,7059,7067,7076,7084,7092,7101,7109,7117,7126,7134,7142,7150,7159,7167,7175,7184,7192,7200,7209,7217,7225,7233,7242,7250,7258,7267,7275,7283,7292,7300,7308,7316,7325,7333,7341,7350,7358,7366,7375,7383,7391,7399,7408,7416,7424,7433,7441,7449,7458,7466,7474,7482,7491,7499,7507,7516,7524,7532,7541,7549,7557,7565,7574,7582,7590,7599,7607,7615,7623,7632,7640,7648,7657,7665,7673,7682,7690,7698,7706,7715,7723,7731,7740,7748,7756,7765,7773,7781,7789,7798,7806,7814,7823,7831,7839,7848,7856,7864,7872,7881,7889,7897,7906,7914,7922,7931,7939,7947,7955,7964,7972,7980,7989,7997,8005,8014,8022,8030,8038,8047,8055,8063,8072,8080,8088,8097,8105,8113,8121,8130,8138,8146,8155,8163,8171,8179,8188,8196,8204,8213,8221,8229,8238,8246,8254,8262,8271,8279,8287,8296,8304,8312,8321,8329,8337,8345,8354,8362,8370,8379,8387,8395,8404,8412,8420,8428,8437,8445,8453,8462,8470,8478,8487,8495,8503,8511,8520,8528,8536,8545,8553,8561,8570,8578,8586,8594,8603,8611,8619,8628,8636,8644,8653,8661,8669,8677,8686,8694,8702,8711,8719,8727,8736,8744,8752,8760,8769,8777,8785,8794,8802,8810,8818,8827,8835,8843,8852,8860,8868,8877,8885,8893,8901,8910,8918,8926,8935,8943,8951,8960,8968,8976,8984,8993,9001,9009,9018,9026,9034,9043,9051,9059,9067,9076,9084,9092,9101,9109,9117,9126,9134,9142,9150,9159,9167,9175,9184,9192,9200,9209,9217,9225,9233,9242,9250,9258,9267,9275,9283,9292,9300,9308,9316,9325,9333,9341,9350,9358,9366,9374,9383,9391,9399,9408,9416,9424,9433,9441,9449,9457,9466,9474,9482,9491,9499,9507,9516,9524,9532,9540,9549,9557,9565,9574,9582,9590,9599,9607,9615,9623,9632,9640,9648,9657,9665,9673,9682,9690,9698,9706,9715,9723,9731,9740,9748,9756,9765,9773,9781,9789,9798,9806,9814,9823,9831,9839,9848,9856,9864,9872,9881,9889,9897,9906,9914,9922,9931,9939,9947,9955,9964,9972,9980,9989,9997,10005,10013,10022,10030,10038,10047,10055,10063,10072,10080,10088,10096,10105,10113,10121,10130,10138,10146,10155,10163,10171,10179,10188,10196,10204,10213,10221,10229,10238,10246,10254,10262,10271,10279,10287,10296,10304,10312,10321,10329,10337,10345,10354,10362,10370,10379,10387,10395,10404,10412,10420,10428,10437,10445,10453,10462,10470,10478,10487,10495,10503,10511,10520,10528,10536,10545,10553,10561,10569,10578,10586,10594,10603,10611,10619,10628,10636,10644,10652,10661,10669,10677,10686,10694,10702,10711,10719,10727,10735,10744,10752,10760,10769,10777,10785,10794,10802,10810,10818,10827,10835,10843,10852,10860,10868,10877,10885,10893,10901,10910,10918,10926,10935,10943,10951,10960,10968,10976,10984,10993,11001,11009,11018,11026,11034,11043,11051,11059,11067,11076,11084,11092,11101,11109,11117,11126,11134,11142,11150,11159,11167,11175,11184,11192,11200,11208,11217,11225,11233,11242,11250,11258,11267,11275,11283,11291,11300,11308,11316,11325,11333,11341,11350,11358,11366,11374,11383,11391,11399,11408,11416,11424,11433,11441,11449,11457,11466,11474,11482,11491,11499,11507,11516,11524,11532,11540,11549,11557,11565,11574,11582,11590,11599,11607,11615,11623,11632,11640,11648,11657,11665,11673,11682,11690,11698,11706,11715,11723,11731,11740,11748,11756,11764,11773,11781,11789,11798,11806,11814,11823,11831,11839,11847,11856,11864,11872,11881,11889,11897,11906,11914,11922,11930,11939,11947,11955,11964,11972,11980,11989,11997,12005,12013,12022,12030,12038,12047,12055,12063,12072,12080,12088,12096,12105,12113,12121,12130,12138,12146,12155,12163,12171,12179,12188,12196,12204,12213,12221,12229,12238,12246,12254,12262,12271,12279,12287,12296,12304,12312,12321,12329,12337,12345,12354,12362,12370,12379,12387,12395,12403,12412,12420,12428,12437,12445,12453,12462,12470,12478,12486,12495,12503,12511,12520,12528,12536,12545,12553,12561,12569,12578,12586,12594,12603,12611,12619,12628,12636,12644,12652,12661,12669,12677,12686,12694,12702,12711,12719,12727,12735,12744,12752,12760,12769,12777,12785,12794,12802,12810,12818,12827,12835,12843,12852,12860,12868,12877,12885,12893,12901,12910,12918,12926,12935,12943,12951,12959,12968,12976,12984,12993,13001,13009,13018,13026,13034,13042,13051,13059,13067,13076,13084,13092,13101,13109,13117,13125,13134,13142,13150,13159,13167,13175,13184,13192,13200,13208,13217,13225,13233,13242,13250,13258,13267,13275,13283,13291,13300,13308,13316,13325,13333,13341,13350,13358,13366,13374,13383,13391,13399,13408,13416,13424,13433,13441,13449,13457,13466,13474,13482,13491,13499,13507,13516,13524,13532,13540,13549,13557,13565,13574,13582,13590,13598,13607,13615,13623,13632,13640,13648,13657,13665,13673,13681,13690,13698,13706,13715,13723,13731,13740,13748,13756,13764,13773,13781,13789,13798,13806,13814,13823,13831,13839,13847,13856,13864,13872,13881,13889,13897,13906,13914,13922,13930,13939,13947,13955,13964,13972,13980,13989,13997,14005,14013,14022,14030,14038,14047,14055,14063,14072,14080,14088,14096,14105,14113,14121,14130,14138,14146,14154,14163,14171,14179,14188,14196,14204,14213,14221,14229,14237,14246,14254,14262,14271,14279,14287,14296,14304,14312,14320,14329,14337,14345,14354,14362,14370,14379,14387,14395,14403,14412,14420,14428,14437,14445,14453,14462,14470,14478,14486,14495,14503,14511,14520,14528,14536,14545,14553,14561,14569,14578,14586,14594,14603,14611,14619,14628,14636,14644,14652,14661,14669,14677,14686,14694,14702,14711,14719,14727,14735,14744,14752,14760,14769,14777,14785,14793,14802,14810,14818,14827,14835,14843,14852,14860,14868,14876,14885,14893,14901,14910,14918,14926,14935,14943,14951,14959,14968,14976,14984,14993,15001,15009,15018,15026,15034,15042,15051,15059,15067,15076,15084,15092,15101,15109,15117,15125,15134,15142,15150,15159,15167,15175,15184,15192,15200,15208,15217,15225,15233,15242,15250,15258,15267,15275,15283,15291,15300,15308,15316,15325,15333,15341,15350,15358,15366,15374,15383,15391,15399,15408,15416,15424,15432,15441,15449,15457,15466,15474,15482,15491,15499,15507,15515,15524,15532,15540,15549,15557,15565,15574,15582,15590,15598,15607,15615,15623,15632,15640,15648,15657,15665,15673,15681,15690,15698,15706,15715,15723,15731,15740,15748,15756,15764,15773,15781,15789,15798,15806,15814,15823,15831,15839,15847,15856,15864,15872,15881,15889,15897,15906,15914,15922,15930,15939,15947,15955,15964,15972,15980,15988,15997,16005,16013,16022,16030,16038,16047,16055,16063,16071,16080,16088,16096,16105,16113,16121,16130,16138,16146,16154,16163,16171,16179,16188,16196,16204,16213,16221,16229,16237,16246,16254,16262,16271,16279,16287,16296,16304,16312,16320,16329,16337,16345,16354,16362,16370,16379,16387,16395,16403,16412,16420,16428,16437,16445,16453,16462,16470,16478,16486,16495,16503,16511,16520,16528,16536,16545,16553,16561,16569,16578,16586,16594,16603,16611,16619,16627,16636,16644,16652,16661,16669,16677,16686,16694,16702,16710,16719,16727,16735,16744,16752,16760,16769,16777,16785,16793,16802,16810,16818,16827,16835,16843,16852,16860,16868,16876,16885,16893,16901,16910,16918,16926,16935,16943,16951,16959,16968,16976,16984,16993,17001,17009,17018,17026,17034,17042,17051,17059,17067,17076,17084,17092,17101,17109,17117,17125,17134,17142,17150,17159,17167,17175,17183,17192,17200,17208,17217,17225,17233,17242,17250,17258,17266,17275,17283,17291,17300,17308,17316,17325,17333,17341,17349,17358,17366,17374,17383,17391,17399,17408,17416,17424,17432,17441,17449,17457,17466,17474,17482,17491,17499,17507,17515,17524,17532,17540,17549,17557,17565,17574,17582,17590,17598,17607,17615,17623,17632,17640,17648,17657,17665,17673,17681,17690,17698,17706,17715,17723,17731,17740,17748,17756,17764,17773,17781,17789,17798,17806,17814,17822,17831,17839,17847,17856,17864,17872,17881,17889,17897,17905,17914,17922,17930,17939,17947,17955,17964,17972,17980,17988,17997,18005,18013,18022,18030,18038,18047,18055,18063,18071,18080,18088,18096,18105,18113,18121,18130,18138,18146,18154,18163,18171,18179,18188,18196,18204,18213,18221,18229,18237,18246,18254,18262,18271,18279,18287,18296,18304,18312,18320,18329,18337,18345,18354,18362,18370,18378,18387,18395,18403,18412,18420,18428,18437,18445,18453,18461,18470,18478,18486,18495,18503,18511,18520,18528,18536,18544,18553,18561,18569,18578,18586,18594,18603,18611,18619,18627,18636,18644,18652,18661,18669,18677,18686,18694,18702,18710,18719,18727,18735,18744,18752,18760,18769,18777,18785,18793,18802,18810,18818,18827,18835,18843,18852,18860,18868,18876,18885,18893,18901,18910,18918,18926,18935,18943,18951,18959,18968,18976,18984,18993,19001,19009,19017,19026,19034,19042,19051,19059,19067,19076,19084,19092,19100,19109,19117,19125,19134,19142,19150,19159,19167,19175,19183,19192,19200,19208,19217,19225,19233,19242,19250,19258,19266,19275,19283,19291,19300,19308,19316,19325,19333,19341,19349,19358,19366,19374,19383,19391,19399,19408,19416,19424,19432,19441,19449,19457,19466,19474,19482,19491,19499,19507,19515,19524,19532,19540,19549,19557,19565,19573,19582,19590,19598,19607,19615,19623,19632,19640,19648,19656,19665,19673,19681,19690,19698,19706,19715,19723,19731,19739,19748,19756,19764,19773,19781,19789,19798,19806,19814,19822,19831,19839,19847,19856,19864,19872,19881,19889,19897,19905,19914,19922,19930,19939,19947,19955,19964,19972,19980,19988,19997,20005,20013,20022,20030,20038,20047,20055,20063,20071,20080,20088,20096,20105,20113,20121,20130,20138,20146,20154,20163,20171,20179,20188,20196,20204,20212,20221,20229,20237,20246,20254,20262,20271,20279,20287,20295,20304,20312,20320,20329,20337,20345,20354,20362,20370,20378,20387,20395,20403,20412,20420,20428,20437,20445,20453,20461,20470,20478,20486,20495,20503,20511,20520,20528,20536,20544,20553,20561,20569,20578,20586,20594,20603,20611,20619,20627,20636,20644,20652,20661,20669,20677,20686,20694,20702,20710,20719,20727,20735,20744,20752,20760,20768,20777,20785,20793,20802,20810,20818,20827,20835,20843,20851,20860,20868,20876,20885,20893,20901,20910,20918,20926,20934,20943,20951,20959,20968,20976,20984,20993,21001,21009,21017,21026,21034,21042,21051,21059,21067,21076,21084,21092,21100,21109,21117,21125,21134,21142,21150,21159,21167,21175,21183,21192,21200,21208,21217,21225,21233,21242,21250,21258,21266,21275,21283,21291,21300,21308,21316,21325,21333,21341,21349,21358,21366,21374,21383,21391,21399,21407,21416,21424,21432,21441,21449,21457,21466,21474,21482,21490,21499,21507,21515,21524,21532,21540,21549,21557,21565,21573,21582,21590,21598,21607,21615,21623,21632,21640,21648,21656,21665,21673,21681,21690,21698,21706,21715,21723,21731,21739,21748,21756,21764,21773,21781,21789,21798,21806,21814,21822,21831,21839,21847,21856,21864,21872,21881,21889,21897,21905,21914,21922,21930,21939,21947,21955,21963,21972,21980,21988,21997,22005,22013,22022,22030,22038,22046,22055,22063,22071,22080,22088,22096,22105,22113,22121,22129,22138,22146,22154,22163,22171,22179,22188,22196,22204,22212,22221,22229,22237,22246,22254,22262,22271,22279,22287,22295,22304,22312,22320,22329,22337,22345,22354,22362,22370,22378,22387,22395,22403,22412,22420,22428,22437,22445,22453,22461,22470,22478,22486,22495,22503,22511,22520,22528,22536,22544,22553,22561,22569,22578,22586,22594,22602,22611,22619,22627,22636,22644,22652,22661,22669,22677,22685,22694,22702,22710,22719,22727,22735,22744,22752,22760,22768,22777,22785,22793,22802,22810,22818,22827,22835,22843,22851,22860,22868,22876,22885,22893,22901,22910,22918,22926,22934,22943,22951,22959,22968,22976,22984,22993,23001,23009,23017,23026,23034,23042,23051,23059,23067,23076,23084,23092,23100,23109,23117,23125,23134,23142,23150,23158,23167,23175,23183,23192,23200,23208,23217,23225,23233,23241,23250,23258,23266,23275,23283,23291,23300,23308,23316,23324,23333,23341,23349,23358,23366,23374,23383,23391,23399,23407,23416,23424,23432,23441,23449,23457,23466,23474,23482,23490,23499,23507,23515,23524,23532,23540,23549,23557,23565,23573,23582,23590,23598,23607,23615,23623,23632,23640,23648,23656,23665,23673,23681,23690,23698,23706,23715,23723,23731,23739,23748,23756,23764,23773,23781,23789,23797,23806,23814,23822,23831,23839,23847,23856,23864,23872,23880,23889,23897,23905,23914,23922,23930,23939,23947,23955,23963,23972,23980,23988,23997,24005,24013,24022,24030,24038,24046,24055,24063,24071,24080,24088,24096,24105,24113,24121,24129,24138,24146,24154,24163,24171,24179,24188,24196,24204,24212,24221,24229,24237,24246,24254,24262,24271,24279,24287,24295,24304,24312,24320,24329,24337,24345,24354,24362,24370,24378,24387,24395,24403,24412,24420,24428,24436,24445,24453,24461,24470,24478,24486,24495,24503,24511,24519,24528,24536,24544,24553,24561,24569,24578,24586,24594,24602,24611,24619,24627,24636,24644,24652,24661,24669,24677,24685,24694,24702,24710,24719,24727,24735,24744,24752,24760,24768,24777,24785,24793,24802,24810,24818,24827,24835,24843,24851,24860,24868,24876,24885,24893,24901,24910,24918,24926,24934,24943,24951,24959,24968,24976,24984,24992,25001,25009,25017,25026,25034,25042,25051,25059,25067,25075,25084,25092,25100,25109,25117,25125,25134,25142,25150,25158,25167,25175,25183,25192,25200,25208,25217,25225,25233,25241,25250,25258,25266,25275,25283,25291,25300,25308,25316,25324,25333,25341,25349,25358,25366,25374,25383,25391,25399,25407,25416,25424,25432,25441,25449,25457,25466,25474,25482,25490,25499,25507,25515,25524,25532,25540,25549,25557,25565,25573,25582,25590,25598,25607,25615,25623,25631,25640,25648,25656,25665,25673,25681,25690,25698,25706,25714,25723,25731,25739,25748,25756,25764,25773,25781,25789,25797,25806,25814,25822,25831,25839,25847,25856,25864,25872,25880,25889,25897,25905,25914,25922,25930,25939,25947,25955,25963,25972,25980,25988,25997,26005,26013,26022,26030,26038,26046,26055,26063,26071,26080,26088,26096,26105,26113,26121,26129,26138,26146,26154,26163,26171,26179,26187,26196,26204,26212,26221,26229,26237,26246,26254,26262,26270,26279,26287,26295,26304,26312,26320,26329,26337,26345,26353,26362,26370,26378,26387,26395,26403,26412,26420,26428,26436,26445,26453,26461,26470,26478,26486,26495,26503,26511,26519,26528,26536,26544,26553,26561,26569,26578,26586,26594,26602,26611,26619,26627,26636,26644,26652,26661,26669,26677,26685,26694,26702,26710,26719,26727,26735,26744,26752,26760,26768,26777,26785,26793,26802,26810,26818,26826,26835,26843,26851,26860,26868,26876,26885,26893,26901,26909,26918,26926,26934,26943,26951,26959,26968,26976,26984,26992,27001,27009,27017,27026,27034,27042,27051,27059,27067,27075,27084,27092,27100,27109,27117,27125,27134,27142,27150,27158,27167,27175,27183,27192,27200,27208,27217,27225,27233,27241,27250,27258,27266,27275,27283,27291,27300,27308,27316,27324,27333,27341,27349,27358,27366,27374,27382,27391,27399,27407,27416,27424,27432,27441,27449,27457,27465,27474,27482,27490,27499,27507,27515,27524,27532,27540,27548,27557,27565,27573,27582,27590,27598,27607,27615,27623,27631,27640,27648,27656,27665,27673,27681,27690,27698,27706,27714,27723,27731,27739,27748,27756,27764,27773,27781,27789,27797,27806,27814,27822,27831,27839,27847,27856,27864,27872,27880,27889,27897,27905,27914,27922,27930,27939,27947,27955,27963,27972,27980,27988,27997,28005,28013,28021,28030,28038,28046,28055,28063,28071,28080,28088,28096,28104,28113,28121,28129,28138,28146,28154,28163,28171,28179,28187,28196,28204,28212,28221,28229,28237,28246,28254,28262,28270,28279,28287,28295,28304,28312,28320,28329,28337,28345,28353,28362,28370,28378,28387,28395,28403,28412,28420,28428,28436,28445,28453,28461,28470,28478,28486,28495,28503,28511,28519,28528,28536,28544,28553,28561,28569,28577,28586,28594,28602,28611,28619,28627,28636,28644,28652,28660,28669,28677,28685,28694,28702,28710,28719,28727,28735,28743,28752,28760,28768,28777,28785,28793,28802,28810,28818,28826,28835,28843,28851,28860,28868,28876,28885,28893,28901,28909,28918,28926,28934,28943,28951,28959,28968,28976,28984,28992,29001,29009,29017,29026,29034,29042,29051,29059,29067,29075,29084,29092,29100,29109,29117,29125,29134,29142,29150,29158,29167,29175,29183,29192,29200,29208,29216,29225,29233,29241,29250,29258,29266,29275,29283,29291,29299,29308,29316,29324,29333,29341,29349,29358,29366,29374,29382,29391,29399,29407,29416,29424,29432,29441,29449,29457,29465,29474,29482,29490,29499,29507,29515,29524,29532,29540,29548,29557,29565,29573,29582,29590,29598,29607,29615,29623,29631,29640,29648,29656,29665,29673,29681,29690,29698,29706,29714,29723,29731,29739,29748,29756,29764,29772,29781,29789,29797,29806,29814,29822,29831,29839,29847,29855,29864,29872,29880,29889,29897,29905,29914,29922,29930,29938,29947,29955,29963,29972,29980,29988,29997,30005,30013,30021,30030,30038,30046,30055,30063,30071,30080,30088,30096,30104,30113,30121,30129,30138,30146,30154,30163,30171,30179,30187,30196,30204,30212,30221,30229,30237,30246,30254,30262,30270,30279,30287,30295,30304,30312,30320,30329,30337,30345,30353,30362,30370,30378,30387,30395,30403,30411,30420,30428,30436,30445,30453,30461,30470,30478,30486,30494,30503,30511,30519,30528,30536,30544,30553,30561,30569,30577,30586,30594,30602,30611,30619,30627,30636,30644,30652,30660,30669,30677,30685,30694,30702,30710,30719,30727,30735,30743,30752,30760,30768,30777,30785,30793,30802,30810,30818,30826,30835,30843,30851,30860,30868,30876,30885,30893,30901,30909,30918,30926,30934,30943,30951,30959,30967,30976,30984,30992,31001,31009,31017,31026,31034,31042,31050,31059,31067,31075,31084,31092,31100,31109,31117,31125,31133,31142,31150,31158,31167,31175,31183,31192,31200,31208,31216,31225,31233,31241,31250,31258,31266,31275,31283,31291,31299,31308,31316,31324,31333,31341,31349,31358,31366,31374,31382,31391,31399,31407,31416,31424,31432,31441,31449,31457,31465,31474,31482,31490,31499,31507,31515,31524,31532,31540,31548,31557,31565,31573,31582,31590,31598,31606,31615,31623,31631,31640,31648,31656,31665,31673,31681,31689,31698,31706,31714,31723,31731,31739,31748,31756,31764,31772,31781,31789,31797,31806,31814,31822,31831,31839,31847,31855,31864,31872,31880,31889,31897,31905,31914,31922,31930,31938,31947,31955,31963,31972,31980,31988,31997,32005,32013,32021,32030,32038,32046,32055,32063,32071,32080,32088,32096,32104,32113,32121,32129,32138,32146,32154,32162,32171,32179,32187,32196,32204,32212,32221,32229,32237,32245,32254,32262,32270,32279,32287,32295,32304,32312,32320,32328,32337,32345,32353,32362,32370,32378,32387,32395,32403,32411,32420,32428,32436,32445,32453,32461,32470,32478,32486,32494,32503,32511,32519,32528,32536,32544,32553,32561,32569,32577,32586,32594,32602,32611,32619,32627,32636,32644,32652,32660,32669,32677,32685,32694,32702,32710,32719,32727,32735,32743,32752,32760, }; 
const uint16_t Lut_G1[] = { 0,8,16,23,31,39,47,55,63,70,78,86,94,102,109,117,125,133,154,175,191,207,227,247,255,263,272,280,289,297,305,314,322,330,339,347,356,364,372,381,389,397,405,414,422,430,439,447,455,463,472,480,488,497,505,513,521,530,538,546,555,563,571,579,588,596,604,613,621,629,637,646,654,662,670,677,684,690,697,704,710,717,724,730,737,744,750,757,764,770,777,784,790,797,804,810,817,824,830,837,844,850,857,864,871,879,887,895,902,910,918,926,934,941,949,957,965,972,980,988,996,1003,1011,1019,1027,1034,1042,1050,1058,1065,1073,1081,1089,1096,1104,1112,1120,1128,1135,1145,1154,1164,1173,1183,1193,1202,1212,1221,1231,1240,1250,1259,1269,1278,1288,1297,1307,1316,1326,1336,1345,1355,1362,1370,1377,1385,1393,1400,1408,1415,1423,1431,1438,1446,1453,1461,1469,1476,1484,1492,1499,1507,1514,1522,1530,1537,1545,1552,1560,1568,1575,1583,1590,1598,1606,1613,1621,1628,1636,1644,1651,1659,1666,1674,1681,1688,1695,1702,1709,1716,1723,1730,1737,1744,1751,1758,1765,1772,1779,1786,1793,1800,1807,1814,1821,1828,1835,1842,1849,1856,1864,1871,1878,1885,1892,1899,1906,1913,1920,1927,1934,1941,1948,1955,1962,1969,1976,1983,1990,1997,2004,2011,2018,2025,2032,2040,2048,2055,2063,2071,2079,2086,2094,2102,2110,2117,2125,2133,2141,2148,2156,2164,2172,2179,2187,2195,2203,2211,2218,2226,2234,2242,2249,2257,2265,2273,2280,2288,2296,2304,2311,2319,2327,2335,2342,2350,2358,2366,2374,2381,2389,2397,2405,2412,2420,2428,2436,2443,2451,2459,2467,2474,2482,2490,2497,2505,2513,2521,2528,2536,2544,2552,2559,2567,2575,2582,2590,2598,2606,2613,2621,2629,2637,2644,2652,2660,2668,2675,2683,2691,2698,2706,2714,2722,2729,2737,2745,2753,2760,2768,2776,2783,2791,2799,2807,2814,2822,2830,2838,2845,2853,2861,2868,2876,2884,2892,2900,2907,2915,2923,2931,2939,2946,2954,2962,2970,2978,2985,2993,3001,3009,3017,3024,3032,3040,3048,3056,3063,3071,3079,3087,3095,3102,3110,3118,3126,3133,3141,3149,3157,3165,3172,3180,3188,3196,3204,3211,3219,3227,3235,3243,3250,3258,3266,3274,3282,3289,3297,3305,3313,3320,3327,3335,3342,3349,3357,3364,3371,3379,3386,3393,3400,3408,3415,3422,3430,3437,3444,3452,3459,3466,3473,3481,3488,3495,3503,3510,3517,3525,3532,3539,3547,3554,3561,3568,3576,3583,3590,3598,3605,3612,3620,3627,3634,3641,3649,3656,3663,3671,3678,3685,3693,3700,3707,3715,3722,3729,3736,3744,3751,3758,3766,3773,3780,3788,3795,3802,3809,3817,3824,3831,3839,3846,3853,3861,3868,3875,3882,3889,3896,3903,3910,3917,3924,3931,3938,3945,3953,3960,3967,3974,3981,3988,3995,4002,4009,4016,4023,4030,4037,4044,4052,4059,4066,4073,4080,4087,4094,4101,4108,4115,4122,4129,4136,4143,4151,4158,4165,4172,4179,4186,4193,4200,4207,4214,4221,4228,4235,4243,4250,4257,4264,4271,4278,4285,4292,4299,4306,4313,4320,4327,4334,4342,4349,4356,4363,4370,4377,4384,4391,4398,4405,4412,4419,4426,4433,4441,4448,4455,4462,4469,4476,4483,4491,4498,4505,4512,4519,4526,4534,4541,4548,4555,4562,4570,4577,4584,4591,4598,4606,4613,4620,4627,4634,4641,4649,4656,4663,4670,4677,4685,4692,4699,4706,4713,4721,4728,4735,4742,4749,4756,4764,4771,4778,4785,4792,4800,4807,4814,4821,4828,4836,4843,4850,4857,4864,4872,4879,4886,4893,4900,4907,4915,4922,4929,4936,4943,4951,4958,4965,4972,4979,4987,4994,5001,5008,5015,5022,5030,5037,5044,5051,5058,5065,5072,5079,5086,5093,5101,5108,5115,5122,5129,5136,5143,5150,5157,5164,5171,5178,5186,5193,5200,5207,5214,5221,5228,5235,5242,5249,5256,5263,5271,5278,5285,5292,5299,5306,5313,5320,5327,5334,5341,5348,5355,5363,5370,5377,5384,5391,5398,5405,5412,5419,5426,5433,5440,5448,5455,5462,5469,5476,5483,5490,5497,5504,5511,5518,5525,5533,5540,5547,5554,5561,5568,5575,5582,5589,5596,5603,5610,5617,5625,5632,5639,5646,5653,5660,5667,5674,5681,5689,5696,5704,5711,5719,5726,5734,5741,5749,5756,5764,5771,5779,5786,5794,5801,5809,5817,5824,5832,5839,5847,5854,5862,5869,5877,5884,5892,5899,5907,5914,5922,5929,5937,5944,5952,5959,5967,5974,5982,5989,5997,6004,6012,6019,6027,6034,6042,6050,6057,6065,6072,6080,6087,6095,6102,6110,6117,6125,6132,6140,6147,6155,6162,6170,6177,6185,6192,6200,6207,6215,6222,6230,6237,6245,6252,6260,6267,6275,6283,6290,6298,6305,6313,6320,6328,6335,6343,6350,6357,6365,6372,6380,6387,6394,6402,6409,6416,6424,6431,6439,6446,6453,6461,6468,6476,6483,6490,6498,6505,6512,6520,6527,6535,6542,6549,6557,6564,6571,6579,6586,6594,6601,6608,6616,6623,6631,6638,6645,6653,6660,6667,6675,6682,6690,6697,6704,6712,6719,6726,6734,6741,6749,6756,6763,6771,6778,6785,6793,6800,6808,6815,6822,6830,6837,6845,6852,6859,6867,6874,6881,6889,6896,6904,6911,6918,6926,6933,6940,6948,6955,6963,6970,6977,6985,6993,7001,7009,7017,7025,7033,7041,7049,7057,7065,7073,7081,7089,7097,7105,7113,7121,7129,7137,7145,7153,7161,7169,7177,7185,7194,7202,7210,7218,7226,7234,7242,7250,7258,7266,7274,7282,7290,7298,7306,7314,7322,7330,7338,7346,7354,7362,7370,7378,7386,7394,7402,7410,7418,7426,7434,7442,7450,7458,7466,7475,7483,7491,7499,7507,7515,7523,7531,7539,7547,7555,7563,7571,7579,7587,7595,7603,7611,7619,7627,7635,7643,7651,7659,7667,7675,7683,7691,7699,7707,7715,7723,7731,7738,7744,7751,7757,7764,7770,7777,7783,7790,7796,7803,7809,7816,7822,7829,7835,7842,7848,7855,7861,7868,7874,7881,7887,7894,7900,7907,7913,7920,7926,7933,7939,7946,7952,7959,7965,7972,7978,7985,7991,7997,8004,8010,8017,8023,8030,8036,8043,8049,8056,8062,8069,8075,8082,8088,8095,8101,8108,8114,8121,8127,8134,8140,8147,8153,8160,8166,8173,8179,8186,8192,8199,8205,8212,8218,8225,8231,8238,8244,8251,8257,8264,8270,8277,8283,8290,8296,8302,8309,8315,8322,8328,8335,8341,8348,8354,8361,8367,8374,8380,8386,8392,8398,8404,8410,8415,8421,8427,8433,8439,8445,8450,8456,8462,8468,8474,8480,8485,8491,8497,8503,8509,8515,8520,8526,8532,8538,8544,8550,8555,8561,8567,8573,8579,8585,8591,8596,8602,8608,8614,8620,8626,8631,8637,8643,8649,8655,8661,8666,8672,8678,8684,8690,8696,8701,8707,8713,8719,8725,8731,8736,8742,8748,8754,8760,8766,8771,8777,8783,8789,8795,8801,8806,8812,8818,8824,8830,8836,8842,8847,8853,8859,8865,8871,8877,8882,8888,8894,8900,8906,8912,8917,8923,8929,8935,8941,8947,8952,8958,8964,8970,8976,8982,8987,8993,8999,9005,9011,9017,9022,9028,9034,9040,9046,9052,9058,9063,9069,9075,9081,9087,9093,9098,9104,9110,9116,9122,9128,9133,9139,9145,9151,9157,9163,9168,9174,9180,9186,9192,9198,9203,9209,9215,9221,9227,9233,9238,9244,9250,9256,9262,9268,9273,9279,9288,9296,9304,9313,9321,9329,9338,9346,9354,9363,9371,9379,9387,9396,9404,9412,9421,9429,9437,9446,9454,9462,9471,9479,9487,9496,9504,9512,9521,9529,9537,9545,9554,9562,9570,9579,9587,9595,9604,9612,9620,9629,9637,9645,9654,9662,9670,9679,9687,9695,9704,9712,9720,9728,9737,9745,9753,9762,9770,9778,9787,9795,9803,9812,9820,9828,9837,9845,9853,9862,9870,9878,9887,9895,9903,9911,9920,9928,9936,9945,9953,9961,9970,9978,9986,9995,10003,10011,10020,10028,10036,10045,10053,10061,10069,10078,10086,10094,10103,10111,10119,10128,10136,10144,10153,10161,10169,10178,10186,10194,10203,10211,10219,10228,10236,10244,10252,10261,10269,10277,10286,10294,10302,10311,10319,10327,10336,10344,10352,10361,10369,10377,10386,10394,10402,10411,10419,10427,10435,10444,10452,10460,10469,10477,10485,10494,10502,10510,10519,10527,10535,10544,10552,10560,10569,10577,10585,10594,10602,10610,10618,10627,10635,10643,10652,10660,10668,10677,10685,10693,10702,10710,10718,10727,10735,10743,10752,10760,10768,10776,10785,10793,10801,10810,10818,10826,10835,10843,10851,10860,10868,10876,10885,10893,10901,10910,10918,10926,10935,10943,10951,10959,10968,10976,10984,10993,11001,11009,11018,11026,11034,11043,11051,11059,11068,11076,11084,11093,11101,11109,11118,11126,11134,11142,11151,11159,11167,11176,11184,11192,11201,11209,11217,11226,11234,11242,11251,11259,11267,11276,11284,11292,11301,11309,11317,11325,11334,11342,11350,11359,11367,11375,11384,11392,11400,11409,11417,11425,11434,11442,11450,11459,11467,11475,11483,11492,11500,11508,11517,11525,11533,11542,11550,11558,11567,11575,11583,11592,11600,11608,11617,11625,11633,11642,11650,11658,11666,11675,11683,11691,11700,11708,11716,11725,11733,11741,11750,11758,11766,11775,11783,11791,11800,11808,11816,11825,11833,11841,11849,11858,11866,11874,11883,11891,11899,11908,11916,11924,11933,11941,11949,11958,11966,11974,11983,11991,11999,12008,12016,12024,12032,12041,12049,12057,12066,12074,12082,12091,12099,12107,12116,12124,12132,12141,12149,12157,12166,12174,12182,12190,12199,12207,12215,12224,12232,12240,12249,12257,12265,12274,12282,12290,12299,12307,12315,12324,12332,12340,12349,12357,12365,12373,12382,12390,12398,12407,12415,12423,12432,12440,12448,12457,12465,12473,12482,12490,12498,12507,12515,12523,12532,12540,12548,12556,12565,12573,12581,12590,12598,12606,12615,12623,12631,12640,12648,12656,12665,12673,12681,12690,12698,12706,12715,12723,12731,12739,12748,12756,12764,12773,12781,12789,12798,12806,12814,12823,12831,12839,12848,12856,12864,12873,12881,12889,12897,12906,12914,12922,12931,12939,12947,12956,12964,12972,12981,12989,12997,13006,13014,13022,13031,13039,13047,13056,13064,13072,13080,13089,13097,13105,13114,13122,13130,13139,13147,13155,13164,13172,13180,13189,13197,13205,13214,13222,13230,13239,13247,13255,13263,13272,13280,13288,13297,13305,13313,13322,13330,13338,13347,13355,13363,13372,13380,13388,13397,13405,13413,13422,13430,13438,13446,13455,13463,13471,13480,13488,13496,13505,13513,13521,13530,13538,13546,13555,13563,13571,13580,13588,13596,13604,13613,13621,13629,13638,13646,13654,13663,13671,13679,13688,13696,13704,13713,13721,13729,13738,13746,13754,13763,13771,13779,13787,13796,13804,13812,13821,13829,13837,13846,13854,13862,13871,13879,13887,13896,13904,13912,13921,13929,13937,13946,13954,13962,13970,13979,13987,13995,14004,14012,14020,14029,14037,14045,14054,14062,14070,14079,14087,14095,14104,14112,14120,14129,14137,14145,14153,14162,14170,14178,14187,14195,14203,14212,14220,14228,14237,14245,14253,14262,14270,14278,14287,14295,14303,14311,14320,14328,14336,14345,14353,14361,14370,14378,14386,14395,14403,14411,14420,14428,14436,14445,14453,14461,14470,14478,14486,14494,14503,14511,14519,14528,14536,14544,14553,14561,14569,14578,14586,14594,14603,14611,14619,14628,14636,14644,14653,14661,14669,14677,14686,14694,14702,14711,14719,14727,14736,14744,14752,14761,14769,14777,14786,14794,14802,14811,14819,14827,14836,14844,14852,14860,14869,14877,14885,14894,14902,14910,14919,14927,14935,14944,14952,14960,14969,14977,14985,14994,15002,15010,15018,15027,15035,15043,15052,15060,15068,15077,15085,15093,15102,15110,15118,15127,15135,15143,15152,15160,15168,15177,15185,15193,15201,15210,15218,15226,15235,15243,15251,15260,15268,15276,15285,15293,15301,15310,15318,15326,15335,15343,15351,15360,15368,15376,15384,15393,15401,15409,15418,15426,15434,15443,15451,15459,15468,15476,15484,15493,15501,15509,15518,15526,15534,15543,15551,15559,15567,15576,15584,15592,15601,15609,15617,15626,15634,15642,15651,15659,15667,15676,15684,15692,15701,15709,15717,15725,15734,15742,15750,15759,15767,15775,15784,15792,15800,15809,15817,15825,15834,15842,15850,15859,15867,15875,15884,15892,15900,15908,15917,15925,15933,15942,15950,15958,15967,15975,15983,15992,16000,16008,16017,16025,16033,16042,16050,16058,16067,16075,16083,16091,16100,16108,16116,16125,16133,16141,16150,16158,16166,16175,16183,16191,16200,16208,16216,16225,16233,16241,16250,16258,16266,16274,16283,16291,16299,16308,16316,16324,16333,16341,16349,16358,16366,16374,16383,16391,16399,16408,16416,16424,16432,16441,16449,16457,16466,16474,16482,16491,16499,16507,16516,16524,16532,16541,16549,16557,16566,16574,16582,16591,16599,16607,16615,16624,16632,16640,16649,16657,16665,16674,16682,16690,16699,16707,16715,16724,16732,16740,16749,16757,16765,16774,16782,16790,16798,16807,16815,16823,16832,16840,16848,16857,16865,16873,16882,16890,16898,16907,16915,16923,16932,16940,16948,16956,16965,16973,16981,16990,16998,17006,17015,17023,17031,17040,17048,17056,17065,17073,17081,17090,17098,17106,17115,17123,17131,17139,17148,17156,17164,17173,17181,17189,17198,17206,17214,17223,17231,17239,17248,17256,17264,17273,17281,17289,17298,17306,17314,17322,17331,17339,17347,17356,17364,17372,17381,17389,17397,17406,17414,17422,17431,17439,17447,17456,17464,17472,17481,17489,17497,17505,17514,17522,17530,17539,17547,17555,17564,17572,17580,17589,17597,17605,17614,17622,17630,17639,17647,17655,17663,17672,17680,17688,17697,17705,17713,17722,17730,17738,17747,17755,17763,17772,17780,17788,17797,17805,17813,17822,17830,17838,17846,17855,17863,17871,17880,17888,17896,17905,17913,17921,17930,17938,17946,17955,17963,17971,17980,17988,17996,18005,18013,18021,18029,18038,18046,18054,18063,18071,18079,18088,18096,18104,18113,18121,18129,18138,18146,18154,18163,18171,18179,18188,18196,18204,18212,18221,18229,18237,18246,18254,18262,18271,18279,18287,18296,18304,18312,18321,18329,18337,18346,18354,18362,18370,18379,18387,18395,18404,18412,18420,18429,18437,18445,18454,18462,18470,18479,18487,18495,18504,18512,18520,18529,18537,18545,18553,18562,18570,18578,18587,18595,18603,18612,18620,18628,18637,18645,18653,18662,18670,18678,18687,18695,18703,18712,18720,18728,18736,18745,18753,18761,18770,18778,18786,18795,18803,18811,18820,18828,18836,18845,18853,18861,18870,18878,18886,18895,18903,18911,18919,18928,18936,18944,18953,18961,18969,18978,18986,18994,19003,19011,19019,19028,19036,19044,19053,19061,19069,19077,19086,19094,19102,19111,19119,19127,19136,19144,19152,19161,19169,19177,19186,19194,19202,19211,19219,19227,19236,19244,19252,19260,19269,19277,19285,19294,19302,19310,19319,19327,19335,19344,19352,19360,19369,19377,19385,19394,19402,19410,19419,19427,19435,19443,19452,19460,19468,19477,19485,19493,19502,19510,19518,19527,19535,19543,19552,19560,19568,19577,19585,19593,19602,19610,19618,19626,19635,19643,19651,19660,19668,19676,19685,19693,19701,19710,19718,19726,19735,19743,19751,19760,19768,19776,19784,19793,19801,19809,19818,19826,19834,19843,19851,19859,19868,19876,19884,19893,19901,19909,19918,19926,19934,19943,19951,19959,19967,19976,19984,19992,20001,20009,20017,20026,20034,20042,20051,20059,20067,20076,20084,20092,20101,20109,20117,20126,20134,20142,20150,20159,20167,20175,20184,20192,20200,20209,20217,20225,20234,20242,20250,20259,20267,20275,20284,20292,20300,20309,20317,20325,20333,20342,20350,20358,20367,20375,20383,20392,20400,20408,20417,20425,20433,20442,20450,20458,20467,20475,20483,20491,20500,20508,20516,20525,20533,20541,20550,20558,20566,20575,20583,20591,20600,20608,20616,20625,20633,20641,20650,20658,20666,20674,20683,20691,20699,20708,20716,20724,20733,20741,20749,20758,20766,20774,20783,20791,20799,20808,20816,20824,20833,20841,20849,20857,20866,20874,20882,20891,20899,20907,20916,20924,20932,20941,20949,20957,20966,20974,20982,20991,20999,21007,21016,21024,21032,21040,21049,21057,21065,21074,21082,21090,21099,21107,21115,21124,21132,21140,21149,21157,21165,21174,21182,21190,21198,21207,21215,21223,21232,21240,21248,21257,21265,21273,21282,21290,21298,21307,21315,21323,21332,21340,21348,21357,21365,21373,21381,21390,21398,21406,21415,21423,21431,21440,21448,21456,21465,21473,21481,21490,21498,21506,21515,21523,21531,21540,21548,21556,21564,21573,21581,21589,21598,21606,21614,21623,21631,21639,21648,21656,21664,21673,21681,21689,21698,21706,21714,21723,21731,21739,21747,21756,21764,21772,21781,21789,21797,21806,21814,21822,21831,21839,21847,21856,21864,21872,21881,21889,21897,21905,21914,21922,21930,21939,21947,21955,21964,21972,21980,21989,21997,22005,22014,22022,22030,22039,22047,22055,22064,22072,22080,22088,22097,22105,22113,22122,22130,22138,22147,22155,22163,22172,22180,22188,22197,22205,22213,22222,22230,22238,22247,22255,22263,22271,22280,22288,22296,22305,22313,22321,22330,22338,22346,22355,22363,22371,22380,22388,22396,22405,22413,22421,22430,22438,22446,22454,22463,22471,22479,22488,22496,22504,22513,22521,22529,22538,22546,22554,22563,22571,22579,22588,22596,22604,22612,22621,22629,22637,22646,22654,22662,22671,22679,22687,22696,22704,22712,22721,22729,22737,22746,22754,22762,22771,22779,22787,22795,22804,22812,22820,22829,22837,22845,22854,22862,22870,22879,22887,22895,22904,22912,22920,22929,22937,22945,22954,22962,22970,22978,22987,22995,23003,23012,23020,23028,23037,23045,23053,23062,23070,23078,23087,23095,23103,23112,23120,23128,23136,23145,23153,23161,23170,23178,23186,23195,23203,23211,23220,23228,23236,23245,23253,23261,23270,23278,23286,23295,23303,23311,23319,23328,23336,23344,23353,23361,23369,23378,23386,23394,23403,23411,23419,23428,23436,23444,23453,23461,23469,23478,23486,23494,23502,23511,23519,23527,23536,23544,23552,23561,23569,23577,23586,23594,23602,23611,23619,23627,23636,23644,23652,23661,23669,23677,23685,23694,23702,23710,23719,23727,23735,23744,23752,23760,23769,23777,23785,23794,23802,23810,23819,23827,23835,23843,23852,23860,23868,23877,23885,23893,23902,23910,23918,23927,23935,23943,23952,23960,23968,23977,23985,23993,24002,24010,24018,24026,24035,24043,24051,24060,24068,24076,24085,24093,24101,24110,24118,24126,24135,24143,24151,24160,24168,24176,24185,24193,24201,24209,24218,24226,24234,24243,24251,24259,24268,24276,24284,24293,24301,24309,24318,24326,24334,24343,24351,24359,24368,24376,24384,24392,24401,24409,24417,24426,24434,24442,24451,24459,24467,24476,24484,24492,24501,24509,24517,24526,24534,24542,24550,24559,24567,24575,24584,24592,24600,24609,24617,24625,24634,24642,24650,24659,24667,24675,24684,24692,24700,24709,24717,24725,24733,24742,24750,24758,24767,24775,24783,24792,24800,24808,24817,24825,24833,24842,24850,24858,24867,24875,24883,24892,24900,24908,24916,24925,24933,24941,24950,24958,24966,24975,24983,24991,25000,25008,25016,25025,25033,25041,25050,25058,25066,25075,25083,25091,25099,25108,25116,25124,25133,25141,25149,25158,25166,25174,25183,25191,25199,25208,25216,25224,25233,25241,25249,25257,25266,25274,25282,25291,25299,25307,25316,25324,25332,25341,25349,25357,25366,25374,25382,25391,25399,25407,25416,25424,25432,25440,25449,25457,25465,25474,25482,25490,25499,25507,25515,25524,25532,25540,25549,25557,25565,25574,25582,25590,25599,25607,25615,25623,25632,25640,25648,25657,25665,25673,25682,25690,25698,25707,25715,25723,25732,25740,25748,25757,25765,25773,25782,25790,25798,25806,25815,25823,25831,25840,25848,25856,25865,25873,25881,25890,25898,25906,25915,25923,25931,25940,25948,25956,25964,25973,25981,25989,25998,26006,26014,26023,26031,26039,26048,26056,26064,26073,26081,26089,26098,26106,26114,26123,26131,26139,26147,26156,26164,26172,26181,26189,26197,26206,26214,26222,26231,26239,26247,26256,26264,26272,26281,26289,26297,26306,26314,26322,26330,26339,26347,26355,26364,26372,26380,26389,26397,26405,26414,26422,26430,26439,26447,26455,26464,26472,26480,26489,26497,26505,26513,26522,26530,26538,26547,26555,26563,26572,26580,26588,26597,26605,26613,26622,26630,26638,26647,26655,26663,26671,26680,26688,26696,26705,26713,26721,26730,26738,26746,26755,26763,26771,26780,26788,26796,26805,26813,26821,26830,26838,26846,26854,26863,26871,26879,26888,26896,26904,26913,26921,26929,26938,26946,26954,26963,26971,26979,26988,26996,27004,27013,27021,27029,27037,27046,27054,27062,27071,27079,27087,27096,27104,27112,27121,27129,27137,27146,27154,27162,27171,27179,27187,27196,27204,27212,27220,27229,27237,27245,27254,27262,27270,27279,27287,27295,27304,27312,27320,27329,27337,27345,27354,27362,27370,27378,27387,27395,27403,27412,27420,27428,27437,27445,27453,27462,27470,27478,27487,27495,27503,27512,27520,27528,27537,27545,27553,27561,27570,27578,27586,27595,27603,27611,27620,27628,27636,27645,27653,27661,27670,27678,27686,27695,27703,27711,27720,27728,27736,27744,27753,27761,27769,27778,27786,27794,27803,27811,27819,27828,27836,27844,27853,27861,27869,27878,27886,27894,27903,27911,27919,27927,27936,27944,27952,27961,27969,27977,27986,27994,28002,28011,28019,28027,28036,28044,28052,28061,28069,28077,28085,28094,28102,28110,28119,28127,28135,28144,28152,28160,28169,28177,28185,28194,28202,28210,28219,28227,28235,28244,28252,28260,28268,28277,28285,28293,28302,28310,28318,28327,28335,28343,28352,28360,28368,28377,28385,28393,28402,28410,28418,28427,28435,28443,28451,28460,28468,28476,28485,28493,28501,28510,28518,28526,28535,28543,28551,28560,28568,28576,28585,28593,28601,28610,28618,28626,28634,28643,28651,28659,28668,28676,28684,28693,28701,28709,28718,28726,28734,28743,28751,28759,28768,28776,28784,28792,28801,28809,28817,28826,28834,28842,28851,28859,28867,28876,28884,28892,28901,28909,28917,28926,28934,28942,28951,28959,28967,28975,28984,28992,29000,29009,29017,29025,29034,29042,29050,29059,29067,29075,29084,29092,29100,29109,29117,29125,29134,29142,29150,29158,29167,29175,29183,29192,29200,29208,29217,29225,29233,29242,29250,29258,29267,29275,29283,29292,29300,29308,29317,29325,29333,29341,29350,29358,29366,29375,29383,29391,29400,29408,29416,29425,29433,29441,29450,29458,29466,29475,29483,29491,29499,29508,29516,29524,29533,29541,29549,29558,29566,29574,29583,29591,29599,29608,29616,29624,29633,29641,29649,29658,29666,29674,29682,29691,29699,29707,29716,29724,29732,29741,29749,29757,29766,29774,29782,29791,29799,29807,29816,29824,29832,29841,29849,29857,29865,29874,29882,29890,29899,29907,29915,29924,29932,29940,29949,29957,29965,29974,29982,29990,29999,30007,30015,30023,30032,30040,30048,30057,30065,30073,30082,30090,30098,30107,30115,30123,30132,30140,30148,30157,30165,30173,30182,30190,30198,30206,30215,30223,30231,30240,30248,30256,30265,30273,30281,30290,30298,30306,30315,30323,30331,30340,30348,30356,30365,30373,30381,30389,30398,30406,30414,30423,30431,30439,30448,30456,30464,30473,30481,30489,30498,30506,30514,30523,30531,30539,30548,30556,30564,30572,30581,30589,30597,30606,30614,30622,30631,30639,30647,30656,30664,30672,30681,30689,30697,30706,30714,30722,30730,30739,30747,30755,30764,30772,30780,30789,30797,30805,30814,30822,30830,30839,30847,30855,30864,30872,30880,30889,30897,30905,30913,30922,30930,30938,30947,30955,30963,30972,30980,30988,30997,31005,31013,31022,31030,31038,31047,31055,31063,31072,31080,31088,31096,31105,31113,31121,31130,31138,31146,31155,31163,31171,31180,31188,31196,31205,31213,31221,31230,31238,31246,31255,31263,31271,31279,31288,31296,31304,31313,31321,31329,31338,31346,31354,31363,31371,31379,31388,31396,31404,31413,31421,31429,31437,31446,31454,31462,31471,31479,31487,31496,31504,31512,31521,31529,31537,31546,31554,31562,31571,31579,31587,31596,31604,31612,31620,31629,31637,31645,31654,31662,31670,31679,31687,31695,31704,31712,31720,31729,31737,31745,31754,31762,31770,31779,31787,31795,31803,31812,31820,31828,31837,31845,31853,31862,31870,31878,31887,31895,31903,31912,31920,31928,31937,31945,31953,31962,31970,31978,31986,31995,32003,32011,32020,32028,32036,32045,32053,32061,32070,32078,32086,32095,32103,32111,32120,32128,32136,32144,32153,32161,32169,32178,32186,32194,32203,32211,32219,32228,32236,32244,32253,32261,32269,32278,32286,32294,32303,32311,32319,32327,32336,32344,32352,32361,32369,32377,32386,32394,32402,32411,32419,32427,32436,32444,32452,32461,32469,32477,32486,32494,32502,32510,32519,32527,32535,32544,32552,32560,32569,32577,32585,32594,32602,32610,32619,32627,32635,32644,32652,32660,32669,32677,32685,32693,32702,32710,32718,32727,32735,32743,32752,32760, }; 
const uint16_t Lut_G2[] = { 0,5,10,16,21,26,31,36,42,47,52,57,62,68,73,78,83,88,94,99,104,109,114,120,125,130,135,140,151,162,174,185,218,239,260,270,279,289,298,308,317,327,337,346,356,365,375,384,392,401,410,418,427,436,445,453,462,471,480,488,497,506,514,523,531,539,547,555,563,571,579,587,595,603,611,619,627,635,643,651,659,666,674,682,690,698,706,714,721,728,735,743,750,757,764,772,779,786,793,801,808,815,822,830,837,844,852,859,866,873,881,888,895,902,910,918,926,935,943,952,960,969,977,985,994,1002,1011,1019,1027,1036,1044,1053,1061,1069,1078,1086,1095,1103,1112,1120,1128,1137,1145,1154,1162,1170,1179,1187,1196,1205,1215,1224,1234,1244,1253,1263,1273,1282,1292,1301,1311,1321,1330,1340,1350,1359,1369,1378,1388,1398,1407,1417,1427,1435,1443,1451,1459,1468,1476,1484,1492,1500,1509,1517,1525,1533,1541,1550,1558,1566,1574,1582,1591,1599,1607,1615,1623,1632,1640,1648,1656,1664,1673,1681,1689,1697,1705,1714,1722,1730,1738,1746,1755,1763,1770,1777,1784,1791,1798,1805,1812,1820,1827,1834,1841,1848,1855,1862,1869,1876,1884,1891,1898,1905,1912,1919,1926,1933,1940,1948,1955,1962,1969,1976,1983,1990,1997,2004,2012,2019,2026,2033,2040,2047,2054,2061,2068,2076,2083,2090,2097,2104,2111,2118,2125,2132,2140,2148,2156,2165,2173,2181,2190,2198,2206,2215,2223,2231,2240,2248,2256,2265,2273,2281,2290,2298,2306,2314,2323,2331,2339,2348,2356,2364,2373,2381,2389,2398,2406,2414,2423,2431,2439,2448,2456,2464,2473,2481,2489,2498,2506,2514,2523,2531,2539,2548,2556,2564,2573,2580,2588,2596,2604,2611,2619,2627,2634,2642,2650,2658,2665,2673,2681,2688,2696,2704,2712,2719,2727,2735,2742,2750,2758,2766,2773,2781,2789,2796,2804,2812,2820,2827,2835,2843,2850,2858,2866,2874,2881,2889,2897,2904,2912,2920,2928,2935,2943,2951,2958,2966,2974,2982,2989,2997,3005,3012,3020,3029,3037,3046,3054,3063,3071,3080,3088,3097,3105,3114,3122,3131,3139,3148,3156,3165,3173,3182,3190,3199,3207,3216,3224,3233,3241,3250,3258,3267,3275,3284,3292,3301,3309,3318,3326,3335,3343,3352,3360,3369,3377,3386,3394,3403,3411,3420,3428,3437,3445,3454,3462,3471,3479,3488,3496,3504,3511,3519,3527,3535,3543,3550,3558,3566,3574,3581,3589,3597,3605,3613,3620,3628,3636,3644,3652,3659,3667,3675,3683,3691,3698,3706,3714,3722,3730,3737,3745,3753,3761,3769,3776,3784,3792,3800,3807,3815,3823,3831,3839,3846,3854,3862,3870,3878,3885,3893,3901,3909,3917,3924,3932,3940,3948,3956,3963,3971,3979,3987,3995,4002,4010,4018,4026,4033,4041,4049,4057,4065,4072,4080,4087,4094,4102,4109,4117,4124,4132,4139,4147,4154,4161,4169,4176,4184,4191,4199,4206,4214,4221,4228,4236,4243,4251,4258,4266,4273,4281,4288,4295,4303,4310,4318,4325,4333,4340,4348,4355,4362,4370,4377,4385,4392,4400,4407,4415,4422,4429,4437,4444,4452,4459,4467,4474,4482,4489,4497,4504,4511,4519,4526,4534,4541,4549,4556,4564,4571,4578,4586,4593,4601,4608,4616,4623,4631,4638,4645,4653,4660,4668,4675,4683,4690,4698,4705,4712,4720,4727,4735,4742,4750,4757,4765,4772,4780,4787,4795,4802,4810,4817,4825,4832,4840,4847,4855,4862,4869,4877,4884,4892,4899,4907,4914,4922,4929,4937,4944,4952,4959,4967,4974,4982,4989,4997,5004,5011,5019,5026,5034,5041,5049,5056,5064,5071,5079,5086,5094,5101,5109,5116,5124,5131,5139,5146,5153,5161,5168,5176,5183,5191,5198,5206,5213,5221,5228,5236,5243,5251,5258,5266,5273,5281,5288,5295,5303,5311,5319,5326,5334,5342,5350,5358,5365,5373,5381,5389,5397,5404,5412,5420,5428,5435,5443,5451,5459,5467,5474,5482,5490,5498,5506,5513,5521,5529,5537,5545,5552,5560,5568,5576,5584,5591,5599,5607,5615,5623,5630,5638,5646,5654,5662,5669,5677,5685,5693,5701,5708,5716,5724,5732,5740,5747,5755,5763,5771,5779,5786,5794,5802,5810,5818,5825,5833,5841,5849,5857,5864,5872,5880,5888,5896,5903,5911,5919,5927,5935,5942,5950,5958,5966,5974,5981,5989,5996,6003,6010,6018,6025,6032,6039,6047,6054,6061,6068,6076,6083,6090,6097,6105,6112,6119,6126,6134,6141,6148,6155,6163,6170,6177,6184,6192,6199,6206,6213,6221,6228,6235,6242,6250,6257,6264,6271,6279,6286,6293,6300,6308,6315,6322,6329,6337,6344,6351,6358,6366,6373,6380,6388,6395,6402,6409,6417,6424,6431,6438,6446,6453,6460,6467,6475,6482,6489,6496,6504,6511,6518,6525,6533,6540,6547,6554,6562,6569,6576,6583,6591,6598,6605,6612,6620,6627,6634,6641,6649,6656,6663,6670,6678,6686,6694,6702,6710,6718,6726,6734,6742,6750,6758,6766,6774,6782,6790,6798,6806,6814,6822,6831,6839,6847,6855,6863,6871,6879,6887,6895,6903,6911,6919,6927,6935,6943,6951,6959,6967,6975,6983,6991,7000,7008,7016,7024,7032,7040,7048,7056,7064,7072,7080,7088,7096,7104,7112,7120,7128,7136,7144,7152,7160,7169,7177,7185,7193,7201,7209,7217,7225,7233,7241,7249,7257,7265,7273,7281,7289,7297,7305,7313,7321,7329,7338,7346,7354,7362,7370,7378,7387,7395,7403,7412,7420,7428,7436,7445,7453,7461,7469,7478,7486,7494,7503,7511,7519,7527,7536,7544,7552,7560,7569,7577,7585,7594,7602,7610,7618,7627,7635,7643,7651,7660,7668,7676,7685,7693,7701,7709,7718,7726,7734,7743,7751,7759,7767,7776,7784,7792,7800,7809,7817,7825,7834,7842,7850,7858,7867,7875,7883,7891,7900,7908,7916,7925,7933,7941,7949,7958,7966,7974,7982,7991,7999,8007,8016,8024,8032,8040,8049,8057,8065,8073,8082,8090,8098,8107,8115,8123,8131,8140,8147,8153,8160,8167,8174,8181,8188,8195,8202,8209,8216,8222,8229,8236,8243,8250,8257,8264,8271,8278,8285,8291,8298,8305,8312,8319,8326,8333,8340,8347,8354,8360,8367,8374,8381,8388,8395,8402,8409,8416,8423,8429,8436,8443,8450,8457,8464,8471,8478,8485,8492,8498,8505,8512,8519,8526,8533,8540,8547,8554,8561,8568,8574,8581,8588,8595,8602,8609,8616,8623,8630,8637,8643,8650,8657,8664,8671,8678,8685,8692,8699,8706,8712,8719,8726,8733,8740,8747,8754,8761,8768,8775,8781,8788,8795,8802,8809,8816,8823,8829,8835,8841,8847,8854,8860,8866,8872,8878,8884,8890,8897,8903,8909,8915,8921,8927,8933,8940,8946,8952,8958,8964,8970,8976,8983,8989,8995,9001,9007,9013,9019,9026,9032,9038,9044,9050,9056,9062,9069,9075,9081,9087,9093,9099,9106,9112,9118,9124,9130,9136,9142,9149,9155,9161,9167,9173,9179,9185,9192,9198,9204,9210,9216,9222,9228,9235,9241,9247,9253,9259,9265,9271,9278,9284,9290,9296,9302,9308,9314,9321,9327,9333,9339,9345,9351,9357,9364,9370,9376,9382,9388,9394,9400,9407,9413,9419,9425,9431,9437,9444,9450,9456,9462,9468,9474,9480,9487,9493,9499,9505,9511,9517,9523,9530,9536,9542,9548,9554,9560,9566,9573,9579,9585,9591,9597,9603,9609,9616,9622,9628,9634,9640,9646,9652,9659,9665,9671,9677,9683,9689,9695,9702,9708,9714,9720,9726,9732,9738,9745,9751,9757,9763,9769,9777,9786,9794,9802,9810,9818,9826,9835,9843,9851,9859,9867,9876,9884,9892,9900,9908,9917,9925,9933,9941,9949,9957,9966,9974,9982,9990,9998,10007,10015,10023,10031,10039,10047,10056,10064,10072,10080,10088,10097,10105,10113,10121,10129,10138,10146,10154,10162,10170,10178,10187,10195,10203,10211,10219,10228,10236,10244,10252,10260,10268,10277,10285,10293,10301,10309,10318,10326,10334,10342,10350,10358,10367,10375,10383,10391,10399,10408,10416,10424,10432,10440,10449,10457,10465,10473,10481,10489,10498,10506,10514,10522,10530,10539,10547,10555,10563,10571,10579,10588,10596,10604,10612,10620,10629,10637,10645,10653,10661,10670,10678,10686,10694,10702,10710,10719,10727,10735,10743,10751,10760,10768,10776,10784,10792,10800,10809,10817,10825,10833,10841,10850,10858,10866,10874,10882,10891,10899,10907,10915,10923,10931,10940,10948,10956,10964,10972,10981,10989,10997,11005,11013,11021,11030,11038,11046,11054,11062,11071,11079,11087,11095,11103,11111,11120,11128,11136,11144,11152,11161,11169,11177,11185,11193,11202,11210,11218,11226,11234,11242,11251,11259,11267,11275,11283,11292,11300,11308,11316,11324,11332,11341,11349,11357,11365,11373,11382,11390,11398,11406,11414,11423,11431,11439,11447,11455,11463,11472,11480,11488,11496,11504,11513,11521,11529,11537,11545,11553,11562,11570,11578,11586,11594,11603,11611,11619,11627,11635,11643,11652,11660,11668,11676,11684,11693,11701,11709,11717,11725,11734,11742,11750,11758,11766,11774,11783,11791,11799,11807,11815,11824,11832,11840,11848,11856,11864,11873,11881,11889,11897,11905,11914,11922,11930,11938,11946,11955,11963,11971,11979,11987,11995,12004,12012,12020,12028,12036,12045,12053,12061,12069,12077,12085,12094,12102,12110,12118,12126,12135,12143,12151,12159,12167,12176,12184,12192,12200,12208,12216,12225,12233,12241,12249,12257,12266,12274,12282,12290,12298,12306,12315,12323,12331,12339,12347,12356,12364,12372,12380,12388,12396,12405,12413,12421,12429,12437,12446,12454,12462,12470,12478,12487,12495,12503,12511,12519,12527,12536,12544,12552,12560,12568,12577,12585,12593,12601,12609,12617,12626,12634,12642,12650,12658,12667,12675,12683,12691,12699,12708,12716,12724,12732,12740,12748,12757,12765,12773,12781,12789,12798,12806,12814,12822,12830,12838,12847,12855,12863,12871,12879,12888,12896,12904,12912,12920,12928,12937,12945,12953,12961,12969,12978,12986,12994,13002,13010,13019,13027,13035,13043,13051,13059,13068,13076,13084,13092,13100,13109,13117,13125,13133,13141,13149,13158,13166,13174,13182,13190,13199,13207,13215,13223,13231,13240,13248,13256,13264,13272,13280,13289,13297,13305,13313,13321,13330,13338,13346,13354,13362,13370,13379,13387,13395,13403,13411,13420,13428,13436,13444,13452,13460,13469,13477,13485,13493,13501,13510,13518,13526,13534,13542,13551,13559,13567,13575,13583,13591,13600,13608,13616,13624,13632,13641,13649,13657,13665,13673,13681,13690,13698,13706,13714,13722,13731,13739,13747,13755,13763,13772,13780,13788,13796,13804,13812,13821,13829,13837,13845,13853,13862,13870,13878,13886,13894,13902,13911,13919,13927,13935,13943,13952,13960,13968,13976,13984,13993,14001,14009,14017,14025,14033,14042,14050,14058,14066,14074,14083,14091,14099,14107,14115,14123,14132,14140,14148,14156,14164,14173,14181,14189,14197,14205,14213,14222,14230,14238,14246,14254,14263,14271,14279,14287,14295,14304,14312,14320,14328,14336,14344,14353,14361,14369,14377,14385,14394,14402,14410,14418,14426,14434,14443,14451,14459,14467,14475,14484,14492,14500,14508,14516,14525,14533,14541,14549,14557,14565,14574,14582,14590,14598,14606,14615,14623,14631,14639,14647,14655,14664,14672,14680,14688,14696,14705,14713,14721,14729,14737,14745,14754,14762,14770,14778,14786,14795,14803,14811,14819,14827,14836,14844,14852,14860,14868,14876,14885,14893,14901,14909,14917,14926,14934,14942,14950,14958,14966,14975,14983,14991,14999,15007,15016,15024,15032,15040,15048,15057,15065,15073,15081,15089,15097,15106,15114,15122,15130,15138,15147,15155,15163,15171,15179,15187,15196,15204,15212,15220,15228,15237,15245,15253,15261,15269,15277,15286,15294,15302,15310,15318,15327,15335,15343,15351,15359,15368,15376,15384,15392,15400,15408,15417,15425,15433,15441,15449,15458,15466,15474,15482,15490,15498,15507,15515,15523,15531,15539,15548,15556,15564,15572,15580,15589,15597,15605,15613,15621,15629,15638,15646,15654,15662,15670,15679,15687,15695,15703,15711,15719,15728,15736,15744,15752,15760,15769,15777,15785,15793,15801,15810,15818,15826,15834,15842,15850,15859,15867,15875,15883,15891,15900,15908,15916,15924,15932,15940,15949,15957,15965,15973,15981,15990,15998,16006,16014,16022,16030,16039,16047,16055,16063,16071,16080,16088,16096,16104,16112,16121,16129,16137,16145,16153,16161,16170,16178,16186,16194,16202,16211,16219,16227,16235,16243,16251,16260,16268,16276,16284,16292,16301,16309,16317,16325,16333,16342,16350,16358,16366,16374,16382,16391,16399,16407,16415,16423,16432,16440,16448,16456,16464,16472,16481,16489,16497,16505,16513,16522,16530,16538,16546,16554,16562,16571,16579,16587,16595,16603,16612,16620,16628,16636,16644,16653,16661,16669,16677,16685,16693,16702,16710,16718,16726,16734,16743,16751,16759,16767,16775,16783,16792,16800,16808,16816,16824,16833,16841,16849,16857,16865,16874,16882,16890,16898,16906,16914,16923,16931,16939,16947,16955,16964,16972,16980,16988,16996,17004,17013,17021,17029,17037,17045,17054,17062,17070,17078,17086,17094,17103,17111,17119,17127,17135,17144,17152,17160,17168,17176,17185,17193,17201,17209,17217,17225,17234,17242,17250,17258,17266,17275,17283,17291,17299,17307,17315,17324,17332,17340,17348,17356,17365,17373,17381,17389,17397,17406,17414,17422,17430,17438,17446,17455,17463,17471,17479,17487,17496,17504,17512,17520,17528,17536,17545,17553,17561,17569,17577,17586,17594,17602,17610,17618,17627,17635,17643,17651,17659,17667,17676,17684,17692,17700,17708,17717,17725,17733,17741,17749,17757,17766,17774,17782,17790,17798,17807,17815,17823,17831,17839,17847,17856,17864,17872,17880,17888,17897,17905,17913,17921,17929,17938,17946,17954,17962,17970,17978,17987,17995,18003,18011,18019,18028,18036,18044,18052,18060,18068,18077,18085,18093,18101,18109,18118,18126,18134,18142,18150,18159,18167,18175,18183,18191,18199,18208,18216,18224,18232,18240,18249,18257,18265,18273,18281,18289,18298,18306,18314,18322,18330,18339,18347,18355,18363,18371,18379,18388,18396,18404,18412,18420,18429,18437,18445,18453,18461,18470,18478,18486,18494,18502,18510,18519,18527,18535,18543,18551,18560,18568,18576,18584,18592,18600,18609,18617,18625,18633,18641,18650,18658,18666,18674,18682,18691,18699,18707,18715,18723,18731,18740,18748,18756,18764,18772,18781,18789,18797,18805,18813,18821,18830,18838,18846,18854,18862,18871,18879,18887,18895,18903,18912,18920,18928,18936,18944,18952,18961,18969,18977,18985,18993,19002,19010,19018,19026,19034,19042,19051,19059,19067,19075,19083,19092,19100,19108,19116,19124,19132,19141,19149,19157,19165,19173,19182,19190,19198,19206,19214,19223,19231,19239,19247,19255,19263,19272,19280,19288,19296,19304,19313,19321,19329,19337,19345,19353,19362,19370,19378,19386,19394,19403,19411,19419,19427,19435,19444,19452,19460,19468,19476,19484,19493,19501,19509,19517,19525,19534,19542,19550,19558,19566,19574,19583,19591,19599,19607,19615,19624,19632,19640,19648,19656,19664,19673,19681,19689,19697,19705,19714,19722,19730,19738,19746,19755,19763,19771,19779,19787,19795,19804,19812,19820,19828,19836,19845,19853,19861,19869,19877,19885,19894,19902,19910,19918,19926,19935,19943,19951,19959,19967,19976,19984,19992,20000,20008,20016,20025,20033,20041,20049,20057,20066,20074,20082,20090,20098,20106,20115,20123,20131,20139,20147,20156,20164,20172,20180,20188,20196,20205,20213,20221,20229,20237,20246,20254,20262,20270,20278,20287,20295,20303,20311,20319,20327,20336,20344,20352,20360,20368,20377,20385,20393,20401,20409,20417,20426,20434,20442,20450,20458,20467,20475,20483,20491,20499,20508,20516,20524,20532,20540,20548,20557,20565,20573,20581,20589,20598,20606,20614,20622,20630,20638,20647,20655,20663,20671,20679,20688,20696,20704,20712,20720,20729,20737,20745,20753,20761,20769,20778,20786,20794,20802,20810,20819,20827,20835,20843,20851,20859,20868,20876,20884,20892,20900,20909,20917,20925,20933,20941,20949,20958,20966,20974,20982,20990,20999,21007,21015,21023,21031,21040,21048,21056,21064,21072,21080,21089,21097,21105,21113,21121,21130,21138,21146,21154,21162,21170,21179,21187,21195,21203,21211,21220,21228,21236,21244,21252,21261,21269,21277,21285,21293,21301,21310,21318,21326,21334,21342,21351,21359,21367,21375,21383,21391,21400,21408,21416,21424,21432,21441,21449,21457,21465,21473,21481,21490,21498,21506,21514,21522,21531,21539,21547,21555,21563,21572,21580,21588,21596,21604,21612,21621,21629,21637,21645,21653,21662,21670,21678,21686,21694,21702,21711,21719,21727,21735,21743,21752,21760,21768,21776,21784,21793,21801,21809,21817,21825,21833,21842,21850,21858,21866,21874,21883,21891,21899,21907,21915,21923,21932,21940,21948,21956,21964,21973,21981,21989,21997,22005,22013,22022,22030,22038,22046,22054,22063,22071,22079,22087,22095,22104,22112,22120,22128,22136,22144,22153,22161,22169,22177,22185,22194,22202,22210,22218,22226,22234,22243,22251,22259,22267,22275,22284,22292,22300,22308,22316,22325,22333,22341,22349,22357,22365,22374,22382,22390,22398,22406,22415,22423,22431,22439,22447,22455,22464,22472,22480,22488,22496,22505,22513,22521,22529,22537,22546,22554,22562,22570,22578,22586,22595,22603,22611,22619,22627,22636,22644,22652,22660,22668,22676,22685,22693,22701,22709,22717,22726,22734,22742,22750,22758,22766,22775,22783,22791,22799,22807,22816,22824,22832,22840,22848,22857,22865,22873,22881,22889,22897,22906,22914,22922,22930,22938,22947,22955,22963,22971,22979,22987,22996,23004,23012,23020,23028,23037,23045,23053,23061,23069,23078,23086,23094,23102,23110,23118,23127,23135,23143,23151,23159,23168,23176,23184,23192,23200,23208,23217,23225,23233,23241,23249,23258,23266,23274,23282,23290,23298,23307,23315,23323,23331,23339,23348,23356,23364,23372,23380,23389,23397,23405,23413,23421,23429,23438,23446,23454,23462,23470,23479,23487,23495,23503,23511,23519,23528,23536,23544,23552,23560,23569,23577,23585,23593,23601,23610,23618,23626,23634,23642,23650,23659,23667,23675,23683,23691,23700,23708,23716,23724,23732,23740,23749,23757,23765,23773,23781,23790,23798,23806,23814,23822,23831,23839,23847,23855,23863,23871,23880,23888,23896,23904,23912,23921,23929,23937,23945,23953,23961,23970,23978,23986,23994,24002,24011,24019,24027,24035,24043,24051,24060,24068,24076,24084,24092,24101,24109,24117,24125,24133,24142,24150,24158,24166,24174,24182,24191,24199,24207,24215,24223,24232,24240,24248,24256,24264,24272,24281,24289,24297,24305,24313,24322,24330,24338,24346,24354,24363,24371,24379,24387,24395,24403,24412,24420,24428,24436,24444,24453,24461,24469,24477,24485,24493,24502,24510,24518,24526,24534,24543,24551,24559,24567,24575,24583,24592,24600,24608,24616,24624,24633,24641,24649,24657,24665,24674,24682,24690,24698,24706,24714,24723,24731,24739,24747,24755,24764,24772,24780,24788,24796,24804,24813,24821,24829,24837,24845,24854,24862,24870,24878,24886,24895,24903,24911,24919,24927,24935,24944,24952,24960,24968,24976,24985,24993,25001,25009,25017,25025,25034,25042,25050,25058,25066,25075,25083,25091,25099,25107,25115,25124,25132,25140,25148,25156,25165,25173,25181,25189,25197,25206,25214,25222,25230,25238,25246,25255,25263,25271,25279,25287,25296,25304,25312,25320,25328,25336,25345,25353,25361,25369,25377,25386,25394,25402,25410,25418,25427,25435,25443,25451,25459,25467,25476,25484,25492,25500,25508,25517,25525,25533,25541,25549,25557,25566,25574,25582,25590,25598,25607,25615,25623,25631,25639,25648,25656,25664,25672,25680,25688,25697,25705,25713,25721,25729,25738,25746,25754,25762,25770,25778,25787,25795,25803,25811,25819,25828,25836,25844,25852,25860,25868,25877,25885,25893,25901,25909,25918,25926,25934,25942,25950,25959,25967,25975,25983,25991,25999,26008,26016,26024,26032,26040,26049,26057,26065,26073,26081,26089,26098,26106,26114,26122,26130,26139,26147,26155,26163,26171,26180,26188,26196,26204,26212,26220,26229,26237,26245,26253,26261,26270,26278,26286,26294,26302,26310,26319,26327,26335,26343,26351,26360,26368,26376,26384,26392,26400,26409,26417,26425,26433,26441,26450,26458,26466,26474,26482,26491,26499,26507,26515,26523,26531,26540,26548,26556,26564,26572,26581,26589,26597,26605,26613,26621,26630,26638,26646,26654,26662,26671,26679,26687,26695,26703,26712,26720,26728,26736,26744,26752,26761,26769,26777,26785,26793,26802,26810,26818,26826,26834,26842,26851,26859,26867,26875,26883,26892,26900,26908,26916,26924,26932,26941,26949,26957,26965,26973,26982,26990,26998,27006,27014,27023,27031,27039,27047,27055,27063,27072,27080,27088,27096,27104,27113,27121,27129,27137,27145,27153,27162,27170,27178,27186,27194,27203,27211,27219,27227,27235,27244,27252,27260,27268,27276,27284,27293,27301,27309,27317,27325,27334,27342,27350,27358,27366,27374,27383,27391,27399,27407,27415,27424,27432,27440,27448,27456,27465,27473,27481,27489,27497,27505,27514,27522,27530,27538,27546,27555,27563,27571,27579,27587,27595,27604,27612,27620,27628,27636,27645,27653,27661,27669,27677,27685,27694,27702,27710,27718,27726,27735,27743,27751,27759,27767,27776,27784,27792,27800,27808,27816,27825,27833,27841,27849,27857,27866,27874,27882,27890,27898,27906,27915,27923,27931,27939,27947,27956,27964,27972,27980,27988,27997,28005,28013,28021,28029,28037,28046,28054,28062,28070,28078,28087,28095,28103,28111,28119,28127,28136,28144,28152,28160,28168,28177,28185,28193,28201,28209,28217,28226,28234,28242,28250,28258,28267,28275,28283,28291,28299,28308,28316,28324,28332,28340,28348,28357,28365,28373,28381,28389,28398,28406,28414,28422,28430,28438,28447,28455,28463,28471,28479,28488,28496,28504,28512,28520,28529,28537,28545,28553,28561,28569,28578,28586,28594,28602,28610,28619,28627,28635,28643,28651,28659,28668,28676,28684,28692,28700,28709,28717,28725,28733,28741,28750,28758,28766,28774,28782,28790,28799,28807,28815,28823,28831,28840,28848,28856,28864,28872,28880,28889,28897,28905,28913,28921,28930,28938,28946,28954,28962,28970,28979,28987,28995,29003,29011,29020,29028,29036,29044,29052,29061,29069,29077,29085,29093,29101,29110,29118,29126,29134,29142,29151,29159,29167,29175,29183,29191,29200,29208,29216,29224,29232,29241,29249,29257,29265,29273,29282,29290,29298,29306,29314,29322,29331,29339,29347,29355,29363,29372,29380,29388,29396,29404,29412,29421,29429,29437,29445,29453,29462,29470,29478,29486,29494,29502,29511,29519,29527,29535,29543,29552,29560,29568,29576,29584,29593,29601,29609,29617,29625,29633,29642,29650,29658,29666,29674,29683,29691,29699,29707,29715,29723,29732,29740,29748,29756,29764,29773,29781,29789,29797,29805,29814,29822,29830,29838,29846,29854,29863,29871,29879,29887,29895,29904,29912,29920,29928,29936,29944,29953,29961,29969,29977,29985,29994,30002,30010,30018,30026,30034,30043,30051,30059,30067,30075,30084,30092,30100,30108,30116,30125,30133,30141,30149,30157,30165,30174,30182,30190,30198,30206,30215,30223,30231,30239,30247,30255,30264,30272,30280,30288,30296,30305,30313,30321,30329,30337,30346,30354,30362,30370,30378,30386,30395,30403,30411,30419,30427,30436,30444,30452,30460,30468,30476,30485,30493,30501,30509,30517,30526,30534,30542,30550,30558,30567,30575,30583,30591,30599,30607,30616,30624,30632,30640,30648,30657,30665,30673,30681,30689,30697,30706,30714,30722,30730,30738,30747,30755,30763,30771,30779,30787,30796,30804,30812,30820,30828,30837,30845,30853,30861,30869,30878,30886,30894,30902,30910,30918,30927,30935,30943,30951,30959,30968,30976,30984,30992,31000,31008,31017,31025,31033,31041,31049,31058,31066,31074,31082,31090,31099,31107,31115,31123,31131,31139,31148,31156,31164,31172,31180,31189,31197,31205,31213,31221,31229,31238,31246,31254,31262,31270,31279,31287,31295,31303,31311,31319,31328,31336,31344,31352,31360,31369,31377,31385,31393,31401,31410,31418,31426,31434,31442,31450,31459,31467,31475,31483,31491,31500,31508,31516,31524,31532,31540,31549,31557,31565,31573,31581,31590,31598,31606,31614,31622,31631,31639,31647,31655,31663,31671,31680,31688,31696,31704,31712,31721,31729,31737,31745,31753,31761,31770,31778,31786,31794,31802,31811,31819,31827,31835,31843,31851,31860,31868,31876,31884,31892,31901,31909,31917,31925,31933,31942,31950,31958,31966,31974,31982,31991,31999,32007,32015,32023,32032,32040,32048,32056,32064,32072,32081,32089,32097,32105,32113,32122,32130,32138,32146,32154,32163,32171,32179,32187,32195,32203,32212,32220,32228,32236,32244,32253,32261,32269,32277,32285,32293,32302,32310,32318,32326,32334,32343,32351,32359,32367,32375,32384,32392,32400,32408,32416,32424,32433,32441,32449,32457,32465,32474,32482,32490,32498,32506,32514,32523,32531,32539,32547,32555,32564,32572,32580,32588,32596,32604,32613,32621,32629,32637,32645,32654,32662,32670,32678,32686,32695,32703,32711,32719,32727,32735,32744,32752,32760, }; 
const uint16_t Lut_B [] = { 0,5,11,16,21,27,32,37,42,48,53,58,64,69,74,80,85,90,96,101,106,112,124,137,165,180,194,204,214,224,235,245,255,265,276,284,293,302,311,320,329,337,346,355,364,373,382,390,399,407,415,423,431,440,448,456,464,472,481,489,497,505,514,522,529,537,545,552,560,568,575,583,591,598,606,613,621,629,636,644,652,659,667,675,683,691,698,706,714,722,730,738,745,753,761,769,777,785,793,800,808,816,824,832,840,847,855,863,871,881,891,901,911,921,931,941,951,962,972,982,992,1002,1012,1022,1032,1042,1050,1058,1066,1073,1081,1089,1097,1105,1113,1120,1128,1136,1144,1152,1160,1167,1175,1183,1191,1199,1207,1215,1222,1230,1238,1246,1254,1262,1269,1277,1284,1291,1299,1306,1313,1320,1328,1335,1342,1349,1357,1364,1371,1379,1386,1393,1400,1408,1415,1422,1430,1437,1444,1451,1459,1466,1473,1480,1488,1495,1502,1510,1517,1524,1531,1539,1546,1554,1563,1571,1579,1587,1596,1604,1612,1620,1629,1637,1645,1653,1662,1670,1678,1687,1695,1703,1711,1720,1728,1736,1744,1753,1761,1769,1777,1786,1794,1802,1811,1819,1827,1835,1844,1852,1860,1868,1876,1884,1892,1900,1908,1916,1924,1932,1940,1948,1956,1964,1972,1980,1988,1996,2004,2012,2020,2028,2036,2044,2052,2060,2068,2076,2084,2092,2100,2108,2116,2124,2132,2140,2148,2156,2165,2173,2181,2189,2197,2205,2213,2221,2230,2238,2246,2254,2262,2270,2278,2286,2294,2303,2311,2319,2327,2335,2343,2351,2359,2368,2376,2384,2392,2400,2408,2416,2424,2432,2441,2449,2457,2465,2473,2481,2489,2496,2504,2512,2519,2527,2535,2542,2550,2557,2565,2573,2580,2588,2596,2603,2611,2618,2626,2634,2641,2649,2657,2664,2672,2680,2687,2695,2702,2710,2718,2725,2733,2741,2748,2756,2763,2771,2779,2786,2794,2802,2809,2817,2824,2832,2840,2847,2855,2863,2870,2878,2885,2893,2901,2908,2916,2923,2931,2939,2946,2954,2961,2969,2977,2984,2992,2999,3007,3014,3022,3030,3037,3045,3052,3060,3068,3075,3083,3090,3098,3106,3113,3121,3128,3136,3143,3151,3159,3166,3174,3181,3189,3197,3204,3212,3219,3227,3235,3242,3250,3257,3265,3273,3280,3288,3295,3303,3310,3318,3326,3333,3341,3348,3356,3363,3370,3377,3385,3392,3399,3407,3414,3421,3428,3436,3443,3450,3458,3465,3472,3479,3487,3494,3501,3508,3516,3523,3530,3538,3545,3552,3559,3567,3574,3581,3588,3596,3603,3610,3618,3625,3632,3639,3647,3654,3661,3668,3676,3683,3690,3698,3705,3712,3719,3727,3734,3741,3748,3756,3763,3770,3778,3785,3793,3800,3808,3815,3823,3831,3838,3846,3853,3861,3868,3876,3883,3891,3898,3906,3913,3921,3928,3936,3943,3951,3959,3966,3974,3981,3989,3996,4004,4011,4019,4026,4034,4041,4049,4056,4064,4071,4079,4086,4094,4102,4109,4117,4124,4132,4139,4147,4154,4162,4169,4177,4184,4192,4199,4207,4214,4222,4230,4237,4245,4252,4260,4267,4275,4282,4290,4297,4305,4312,4320,4327,4334,4342,4349,4357,4364,4372,4379,4387,4394,4402,4409,4417,4424,4432,4439,4447,4454,4462,4469,4477,4484,4492,4499,4506,4514,4521,4529,4536,4544,4551,4559,4566,4574,4581,4589,4596,4604,4611,4619,4626,4634,4641,4649,4656,4664,4671,4678,4686,4693,4701,4708,4716,4723,4731,4738,4746,4754,4761,4769,4776,4784,4792,4799,4807,4814,4822,4830,4837,4845,4853,4860,4868,4875,4883,4891,4898,4906,4914,4921,4929,4936,4944,4952,4959,4967,4974,4982,4990,4997,5005,5013,5020,5028,5035,5043,5051,5058,5066,5073,5081,5089,5096,5104,5112,5119,5127,5134,5142,5150,5157,5165,5173,5180,5188,5195,5203,5211,5218,5226,5234,5243,5251,5259,5268,5276,5285,5293,5301,5310,5318,5327,5335,5343,5352,5360,5368,5377,5385,5394,5402,5410,5419,5427,5436,5444,5452,5461,5469,5478,5486,5494,5503,5511,5520,5528,5536,5545,5553,5562,5570,5578,5587,5595,5603,5612,5620,5629,5637,5645,5654,5662,5671,5679,5687,5696,5704,5713,5721,5729,5738,5746,5753,5759,5766,5773,5779,5786,5793,5799,5806,5813,5819,5826,5833,5839,5846,5853,5859,5866,5872,5879,5886,5892,5899,5906,5912,5919,5926,5932,5939,5946,5952,5959,5965,5972,5979,5985,5992,5999,6005,6012,6019,6025,6032,6039,6045,6052,6059,6065,6072,6078,6085,6092,6098,6105,6112,6118,6125,6132,6138,6145,6152,6158,6165,6172,6178,6185,6191,6198,6205,6211,6218,6225,6231,6237,6242,6248,6253,6259,6264,6270,6276,6281,6287,6292,6298,6303,6309,6314,6320,6325,6331,6336,6342,6347,6353,6358,6364,6369,6375,6380,6386,6391,6397,6402,6408,6414,6419,6425,6430,6436,6441,6447,6452,6458,6463,6469,6474,6480,6485,6491,6496,6502,6507,6513,6518,6524,6529,6535,6541,6546,6552,6557,6563,6568,6574,6579,6585,6590,6596,6601,6607,6612,6618,6623,6629,6634,6640,6645,6651,6656,6662,6668,6673,6679,6684,6690,6695,6701,6706,6712,6717,6723,6728,6736,6745,6753,6761,6769,6777,6785,6793,6801,6810,6818,6826,6834,6842,6850,6858,6867,6875,6883,6891,6899,6907,6915,6924,6932,6940,6948,6956,6964,6972,6981,6989,6997,7005,7013,7021,7029,7038,7046,7054,7062,7070,7078,7086,7095,7103,7111,7119,7127,7135,7143,7152,7160,7168,7176,7184,7192,7200,7208,7217,7225,7233,7241,7249,7257,7265,7274,7282,7290,7298,7306,7314,7322,7331,7339,7347,7355,7363,7371,7379,7388,7396,7404,7412,7420,7428,7436,7445,7453,7461,7469,7477,7485,7493,7502,7510,7518,7526,7534,7542,7550,7559,7567,7575,7583,7591,7599,7607,7615,7624,7632,7640,7648,7656,7664,7672,7681,7689,7697,7705,7713,7721,7729,7738,7746,7754,7762,7770,7778,7786,7795,7803,7811,7819,7827,7835,7843,7852,7860,7868,7876,7884,7892,7900,7909,7917,7925,7933,7941,7949,7957,7966,7974,7982,7990,7998,8006,8014,8022,8031,8039,8047,8055,8063,8071,8079,8088,8096,8104,8112,8120,8128,8136,8145,8153,8161,8169,8177,8185,8193,8202,8210,8218,8226,8234,8242,8250,8259,8267,8275,8283,8291,8299,8307,8316,8324,8332,8340,8348,8356,8364,8373,8381,8389,8397,8405,8413,8421,8429,8438,8446,8454,8462,8470,8478,8486,8495,8503,8511,8519,8527,8535,8543,8552,8560,8568,8576,8584,8592,8600,8609,8617,8625,8633,8641,8649,8657,8666,8674,8682,8690,8698,8706,8714,8723,8731,8739,8747,8755,8763,8771,8780,8788,8796,8804,8812,8820,8828,8836,8845,8853,8861,8869,8877,8885,8893,8902,8910,8918,8926,8934,8942,8950,8959,8967,8975,8983,8991,8999,9007,9016,9024,9032,9040,9048,9056,9064,9073,9081,9089,9097,9105,9113,9121,9130,9138,9146,9154,9162,9170,9178,9187,9195,9203,9211,9219,9227,9235,9243,9252,9260,9268,9276,9284,9292,9300,9309,9317,9325,9333,9341,9349,9357,9366,9374,9382,9390,9398,9406,9414,9423,9431,9439,9447,9455,9463,9471,9480,9488,9496,9504,9512,9520,9528,9537,9545,9553,9561,9569,9577,9585,9594,9602,9610,9618,9626,9634,9642,9650,9659,9667,9675,9683,9691,9699,9707,9716,9724,9732,9740,9748,9756,9764,9773,9781,9789,9797,9805,9813,9821,9830,9838,9846,9854,9862,9870,9878,9887,9895,9903,9911,9919,9927,9935,9944,9952,9960,9968,9976,9984,9992,10001,10009,10017,10025,10033,10041,10049,10058,10066,10074,10082,10090,10098,10106,10114,10123,10131,10139,10147,10155,10163,10171,10180,10188,10196,10204,10212,10220,10228,10237,10245,10253,10261,10269,10277,10285,10294,10302,10310,10318,10326,10334,10342,10351,10359,10367,10375,10383,10391,10399,10408,10416,10424,10432,10440,10448,10456,10465,10473,10481,10489,10497,10505,10513,10521,10530,10538,10546,10554,10562,10570,10578,10587,10595,10603,10611,10619,10627,10635,10644,10652,10660,10668,10676,10684,10692,10701,10709,10717,10725,10733,10741,10749,10758,10766,10774,10782,10790,10798,10806,10815,10823,10831,10839,10847,10855,10863,10872,10880,10888,10896,10904,10912,10920,10928,10937,10945,10953,10961,10969,10977,10985,10994,11002,11010,11018,11026,11034,11042,11051,11059,11067,11075,11083,11091,11099,11108,11116,11124,11132,11140,11148,11156,11165,11173,11181,11189,11197,11205,11213,11222,11230,11238,11246,11254,11262,11270,11279,11287,11295,11303,11311,11319,11327,11335,11344,11352,11360,11368,11376,11384,11392,11401,11409,11417,11425,11433,11441,11449,11458,11466,11474,11482,11490,11498,11506,11515,11523,11531,11539,11547,11555,11563,11572,11580,11588,11596,11604,11612,11620,11629,11637,11645,11653,11661,11669,11677,11686,11694,11702,11710,11718,11726,11734,11742,11751,11759,11767,11775,11783,11791,11799,11808,11816,11824,11832,11840,11848,11856,11865,11873,11881,11889,11897,11905,11913,11922,11930,11938,11946,11954,11962,11970,11979,11987,11995,12003,12011,12019,12027,12036,12044,12052,12060,12068,12076,12084,12093,12101,12109,12117,12125,12133,12141,12149,12158,12166,12174,12182,12190,12198,12206,12215,12223,12231,12239,12247,12255,12263,12272,12280,12288,12296,12304,12312,12320,12329,12337,12345,12353,12361,12369,12377,12386,12394,12402,12410,12418,12426,12434,12443,12451,12459,12467,12475,12483,12491,12500,12508,12516,12524,12532,12540,12548,12556,12565,12573,12581,12589,12597,12605,12613,12622,12630,12638,12646,12654,12662,12670,12679,12687,12695,12703,12711,12719,12727,12736,12744,12752,12760,12768,12776,12784,12793,12801,12809,12817,12825,12833,12841,12850,12858,12866,12874,12882,12890,12898,12907,12915,12923,12931,12939,12947,12955,12963,12972,12980,12988,12996,13004,13012,13020,13029,13037,13045,13053,13061,13069,13077,13086,13094,13102,13110,13118,13126,13134,13143,13151,13159,13167,13175,13183,13191,13200,13208,13216,13224,13232,13240,13248,13257,13265,13273,13281,13289,13297,13305,13314,13322,13330,13338,13346,13354,13362,13370,13379,13387,13395,13403,13411,13419,13427,13436,13444,13452,13460,13468,13476,13484,13493,13501,13509,13517,13525,13533,13541,13550,13558,13566,13574,13582,13590,13598,13607,13615,13623,13631,13639,13647,13655,13664,13672,13680,13688,13696,13704,13712,13721,13729,13737,13745,13753,13761,13769,13777,13786,13794,13802,13810,13818,13826,13834,13843,13851,13859,13867,13875,13883,13891,13900,13908,13916,13924,13932,13940,13948,13957,13965,13973,13981,13989,13997,14005,14014,14022,14030,14038,14046,14054,14062,14071,14079,14087,14095,14103,14111,14119,14128,14136,14144,14152,14160,14168,14176,14184,14193,14201,14209,14217,14225,14233,14241,14250,14258,14266,14274,14282,14290,14298,14307,14315,14323,14331,14339,14347,14355,14364,14372,14380,14388,14396,14404,14412,14421,14429,14437,14445,14453,14461,14469,14478,14486,14494,14502,14510,14518,14526,14535,14543,14551,14559,14567,14575,14583,14591,14600,14608,14616,14624,14632,14640,14648,14657,14665,14673,14681,14689,14697,14705,14714,14722,14730,14738,14746,14754,14762,14771,14779,14787,14795,14803,14811,14819,14828,14836,14844,14852,14860,14868,14876,14885,14893,14901,14909,14917,14925,14933,14942,14950,14958,14966,14974,14982,14990,14998,15007,15015,15023,15031,15039,15047,15055,15064,15072,15080,15088,15096,15104,15112,15121,15129,15137,15145,15153,15161,15169,15178,15186,15194,15202,15210,15218,15226,15235,15243,15251,15259,15267,15275,15283,15292,15300,15308,15316,15324,15332,15340,15349,15357,15365,15373,15381,15389,15397,15405,15414,15422,15430,15438,15446,15454,15462,15471,15479,15487,15495,15503,15511,15519,15528,15536,15544,15552,15560,15568,15576,15585,15593,15601,15609,15617,15625,15633,15642,15650,15658,15666,15674,15682,15690,15699,15707,15715,15723,15731,15739,15747,15756,15764,15772,15780,15788,15796,15804,15812,15821,15829,15837,15845,15853,15861,15869,15878,15886,15894,15902,15910,15918,15926,15935,15943,15951,15959,15967,15975,15983,15992,16000,16008,16016,16024,16032,16040,16049,16057,16065,16073,16081,16089,16097,16106,16114,16122,16130,16138,16146,16154,16163,16171,16179,16187,16195,16203,16211,16219,16228,16236,16244,16252,16260,16268,16276,16285,16293,16301,16309,16317,16325,16333,16342,16350,16358,16366,16374,16382,16390,16399,16407,16415,16423,16431,16439,16447,16456,16464,16472,16480,16488,16496,16504,16513,16521,16529,16537,16545,16553,16561,16570,16578,16586,16594,16602,16610,16618,16626,16635,16643,16651,16659,16667,16675,16683,16692,16700,16708,16716,16724,16732,16740,16749,16757,16765,16773,16781,16789,16797,16806,16814,16822,16830,16838,16846,16854,16863,16871,16879,16887,16895,16903,16911,16920,16928,16936,16944,16952,16960,16968,16977,16985,16993,17001,17009,17017,17025,17033,17042,17050,17058,17066,17074,17082,17090,17099,17107,17115,17123,17131,17139,17147,17156,17164,17172,17180,17188,17196,17204,17213,17221,17229,17237,17245,17253,17261,17270,17278,17286,17294,17302,17310,17318,17327,17335,17343,17351,17359,17367,17375,17384,17392,17400,17408,17416,17424,17432,17440,17449,17457,17465,17473,17481,17489,17497,17506,17514,17522,17530,17538,17546,17554,17563,17571,17579,17587,17595,17603,17611,17620,17628,17636,17644,17652,17660,17668,17677,17685,17693,17701,17709,17717,17725,17734,17742,17750,17758,17766,17774,17782,17791,17799,17807,17815,17823,17831,17839,17847,17856,17864,17872,17880,17888,17896,17904,17913,17921,17929,17937,17945,17953,17961,17970,17978,17986,17994,18002,18010,18018,18027,18035,18043,18051,18059,18067,18075,18084,18092,18100,18108,18116,18124,18132,18141,18149,18157,18165,18173,18181,18189,18198,18206,18214,18222,18230,18238,18246,18254,18263,18271,18279,18287,18295,18303,18311,18320,18328,18336,18344,18352,18360,18368,18377,18385,18393,18401,18409,18417,18425,18434,18442,18450,18458,18466,18474,18482,18491,18499,18507,18515,18523,18531,18539,18548,18556,18564,18572,18580,18588,18596,18605,18613,18621,18629,18637,18645,18653,18661,18670,18678,18686,18694,18702,18710,18718,18727,18735,18743,18751,18759,18767,18775,18784,18792,18800,18808,18816,18824,18832,18841,18849,18857,18865,18873,18881,18889,18898,18906,18914,18922,18930,18938,18946,18955,18963,18971,18979,18987,18995,19003,19012,19020,19028,19036,19044,19052,19060,19068,19077,19085,19093,19101,19109,19117,19125,19134,19142,19150,19158,19166,19174,19182,19191,19199,19207,19215,19223,19231,19239,19248,19256,19264,19272,19280,19288,19296,19305,19313,19321,19329,19337,19345,19353,19362,19370,19378,19386,19394,19402,19410,19419,19427,19435,19443,19451,19459,19467,19475,19484,19492,19500,19508,19516,19524,19532,19541,19549,19557,19565,19573,19581,19589,19598,19606,19614,19622,19630,19638,19646,19655,19663,19671,19679,19687,19695,19703,19712,19720,19728,19736,19744,19752,19760,19769,19777,19785,19793,19801,19809,19817,19826,19834,19842,19850,19858,19866,19874,19882,19891,19899,19907,19915,19923,19931,19939,19948,19956,19964,19972,19980,19988,19996,20005,20013,20021,20029,20037,20045,20053,20062,20070,20078,20086,20094,20102,20110,20119,20127,20135,20143,20151,20159,20167,20176,20184,20192,20200,20208,20216,20224,20233,20241,20249,20257,20265,20273,20281,20289,20298,20306,20314,20322,20330,20338,20346,20355,20363,20371,20379,20387,20395,20403,20412,20420,20428,20436,20444,20452,20460,20469,20477,20485,20493,20501,20509,20517,20526,20534,20542,20550,20558,20566,20574,20583,20591,20599,20607,20615,20623,20631,20640,20648,20656,20664,20672,20680,20688,20696,20705,20713,20721,20729,20737,20745,20753,20762,20770,20778,20786,20794,20802,20810,20819,20827,20835,20843,20851,20859,20867,20876,20884,20892,20900,20908,20916,20924,20933,20941,20949,20957,20965,20973,20981,20990,20998,21006,21014,21022,21030,21038,21047,21055,21063,21071,21079,21087,21095,21103,21112,21120,21128,21136,21144,21152,21160,21169,21177,21185,21193,21201,21209,21217,21226,21234,21242,21250,21258,21266,21274,21283,21291,21299,21307,21315,21323,21331,21340,21348,21356,21364,21372,21380,21388,21397,21405,21413,21421,21429,21437,21445,21454,21462,21470,21478,21486,21494,21502,21511,21519,21527,21535,21543,21551,21559,21567,21576,21584,21592,21600,21608,21616,21624,21633,21641,21649,21657,21665,21673,21681,21690,21698,21706,21714,21722,21730,21738,21747,21755,21763,21771,21779,21787,21795,21804,21812,21820,21828,21836,21844,21852,21861,21869,21877,21885,21893,21901,21909,21918,21926,21934,21942,21950,21958,21966,21974,21983,21991,21999,22007,22015,22023,22031,22040,22048,22056,22064,22072,22080,22088,22097,22105,22113,22121,22129,22137,22145,22154,22162,22170,22178,22186,22194,22202,22211,22219,22227,22235,22243,22251,22259,22268,22276,22284,22292,22300,22308,22316,22325,22333,22341,22349,22357,22365,22373,22381,22390,22398,22406,22414,22422,22430,22438,22447,22455,22463,22471,22479,22487,22495,22504,22512,22520,22528,22536,22544,22552,22561,22569,22577,22585,22593,22601,22609,22618,22626,22634,22642,22650,22658,22666,22675,22683,22691,22699,22707,22715,22723,22732,22740,22748,22756,22764,22772,22780,22788,22797,22805,22813,22821,22829,22837,22845,22854,22862,22870,22878,22886,22894,22902,22911,22919,22927,22935,22943,22951,22959,22968,22976,22984,22992,23000,23008,23016,23025,23033,23041,23049,23057,23065,23073,23082,23090,23098,23106,23114,23122,23130,23139,23147,23155,23163,23171,23179,23187,23195,23204,23212,23220,23228,23236,23244,23252,23261,23269,23277,23285,23293,23301,23309,23318,23326,23334,23342,23350,23358,23366,23375,23383,23391,23399,23407,23415,23423,23432,23440,23448,23456,23464,23472,23480,23489,23497,23505,23513,23521,23529,23537,23546,23554,23562,23570,23578,23586,23594,23602,23611,23619,23627,23635,23643,23651,23659,23668,23676,23684,23692,23700,23708,23716,23725,23733,23741,23749,23757,23765,23773,23782,23790,23798,23806,23814,23822,23830,23839,23847,23855,23863,23871,23879,23887,23896,23904,23912,23920,23928,23936,23944,23953,23961,23969,23977,23985,23993,24001,24009,24018,24026,24034,24042,24050,24058,24066,24075,24083,24091,24099,24107,24115,24123,24132,24140,24148,24156,24164,24172,24180,24189,24197,24205,24213,24221,24229,24237,24246,24254,24262,24270,24278,24286,24294,24303,24311,24319,24327,24335,24343,24351,24360,24368,24376,24384,24392,24400,24408,24416,24425,24433,24441,24449,24457,24465,24473,24482,24490,24498,24506,24514,24522,24530,24539,24547,24555,24563,24571,24579,24587,24596,24604,24612,24620,24628,24636,24644,24653,24661,24669,24677,24685,24693,24701,24710,24718,24726,24734,24742,24750,24758,24767,24775,24783,24791,24799,24807,24815,24823,24832,24840,24848,24856,24864,24872,24880,24889,24897,24905,24913,24921,24929,24937,24946,24954,24962,24970,24978,24986,24994,25003,25011,25019,25027,25035,25043,25051,25060,25068,25076,25084,25092,25100,25108,25117,25125,25133,25141,25149,25157,25165,25174,25182,25190,25198,25206,25214,25222,25230,25239,25247,25255,25263,25271,25279,25287,25296,25304,25312,25320,25328,25336,25344,25353,25361,25369,25377,25385,25393,25401,25410,25418,25426,25434,25442,25450,25458,25467,25475,25483,25491,25499,25507,25515,25524,25532,25540,25548,25556,25564,25572,25581,25589,25597,25605,25613,25621,25629,25637,25646,25654,25662,25670,25678,25686,25694,25703,25711,25719,25727,25735,25743,25751,25760,25768,25776,25784,25792,25800,25808,25817,25825,25833,25841,25849,25857,25865,25874,25882,25890,25898,25906,25914,25922,25931,25939,25947,25955,25963,25971,25979,25988,25996,26004,26012,26020,26028,26036,26044,26053,26061,26069,26077,26085,26093,26101,26110,26118,26126,26134,26142,26150,26158,26167,26175,26183,26191,26199,26207,26215,26224,26232,26240,26248,26256,26264,26272,26281,26289,26297,26305,26313,26321,26329,26338,26346,26354,26362,26370,26378,26386,26395,26403,26411,26419,26427,26435,26443,26451,26460,26468,26476,26484,26492,26500,26508,26517,26525,26533,26541,26549,26557,26565,26574,26582,26590,26598,26606,26614,26622,26631,26639,26647,26655,26663,26671,26679,26688,26696,26704,26712,26720,26728,26736,26745,26753,26761,26769,26777,26785,26793,26802,26810,26818,26826,26834,26842,26850,26858,26867,26875,26883,26891,26899,26907,26915,26924,26932,26940,26948,26956,26964,26972,26981,26989,26997,27005,27013,27021,27029,27038,27046,27054,27062,27070,27078,27086,27095,27103,27111,27119,27127,27135,27143,27152,27160,27168,27176,27184,27192,27200,27209,27217,27225,27233,27241,27249,27257,27265,27274,27282,27290,27298,27306,27314,27322,27331,27339,27347,27355,27363,27371,27379,27388,27396,27404,27412,27420,27428,27436,27445,27453,27461,27469,27477,27485,27493,27502,27510,27518,27526,27534,27542,27550,27559,27567,27575,27583,27591,27599,27607,27616,27624,27632,27640,27648,27656,27664,27672,27681,27689,27697,27705,27713,27721,27729,27738,27746,27754,27762,27770,27778,27786,27795,27803,27811,27819,27827,27835,27843,27852,27860,27868,27876,27884,27892,27900,27909,27917,27925,27933,27941,27949,27957,27966,27974,27982,27990,27998,28006,28014,28023,28031,28039,28047,28055,28063,28071,28079,28088,28096,28104,28112,28120,28128,28136,28145,28153,28161,28169,28177,28185,28193,28202,28210,28218,28226,28234,28242,28250,28259,28267,28275,28283,28291,28299,28307,28316,28324,28332,28340,28348,28356,28364,28373,28381,28389,28397,28405,28413,28421,28430,28438,28446,28454,28462,28470,28478,28486,28495,28503,28511,28519,28527,28535,28543,28552,28560,28568,28576,28584,28592,28600,28609,28617,28625,28633,28641,28649,28657,28666,28674,28682,28690,28698,28706,28714,28723,28731,28739,28747,28755,28763,28771,28780,28788,28796,28804,28812,28820,28828,28837,28845,28853,28861,28869,28877,28885,28893,28902,28910,28918,28926,28934,28942,28950,28959,28967,28975,28983,28991,28999,29007,29016,29024,29032,29040,29048,29056,29064,29073,29081,29089,29097,29105,29113,29121,29130,29138,29146,29154,29162,29170,29178,29187,29195,29203,29211,29219,29227,29235,29244,29252,29260,29268,29276,29284,29292,29300,29309,29317,29325,29333,29341,29349,29357,29366,29374,29382,29390,29398,29406,29414,29423,29431,29439,29447,29455,29463,29471,29480,29488,29496,29504,29512,29520,29528,29537,29545,29553,29561,29569,29577,29585,29594,29602,29610,29618,29626,29634,29642,29651,29659,29667,29675,29683,29691,29699,29707,29716,29724,29732,29740,29748,29756,29764,29773,29781,29789,29797,29805,29813,29821,29830,29838,29846,29854,29862,29870,29878,29887,29895,29903,29911,29919,29927,29935,29944,29952,29960,29968,29976,29984,29992,30001,30009,30017,30025,30033,30041,30049,30058,30066,30074,30082,30090,30098,30106,30114,30123,30131,30139,30147,30155,30163,30171,30180,30188,30196,30204,30212,30220,30228,30237,30245,30253,30261,30269,30277,30285,30294,30302,30310,30318,30326,30334,30342,30351,30359,30367,30375,30383,30391,30399,30408,30416,30424,30432,30440,30448,30456,30465,30473,30481,30489,30497,30505,30513,30521,30530,30538,30546,30554,30562,30570,30578,30587,30595,30603,30611,30619,30627,30635,30644,30652,30660,30668,30676,30684,30692,30701,30709,30717,30725,30733,30741,30749,30758,30766,30774,30782,30790,30798,30806,30815,30823,30831,30839,30847,30855,30863,30872,30880,30888,30896,30904,30912,30920,30928,30937,30945,30953,30961,30969,30977,30985,30994,31002,31010,31018,31026,31034,31042,31051,31059,31067,31075,31083,31091,31099,31108,31116,31124,31132,31140,31148,31156,31165,31173,31181,31189,31197,31205,31213,31222,31230,31238,31246,31254,31262,31270,31279,31287,31295,31303,31311,31319,31327,31335,31344,31352,31360,31368,31376,31384,31392,31401,31409,31417,31425,31433,31441,31449,31458,31466,31474,31482,31490,31498,31506,31515,31523,31531,31539,31547,31555,31563,31572,31580,31588,31596,31604,31612,31620,31629,31637,31645,31653,31661,31669,31677,31686,31694,31702,31710,31718,31726,31734,31742,31751,31759,31767,31775,31783,31791,31799,31808,31816,31824,31832,31840,31848,31856,31865,31873,31881,31889,31897,31905,31913,31922,31930,31938,31946,31954,31962,31970,31979,31987,31995,32003,32011,32019,32027,32036,32044,32052,32060,32068,32076,32084,32093,32101,32109,32117,32125,32133,32141,32149,32158,32166,32174,32182,32190,32198,32206,32215,32223,32231,32239,32247,32255,32263,32272,32280,32288,32296,32304,32312,32320,32329,32337,32345,32353,32361,32369,32377,32386,32394,32402,32410,32418,32426,32434,32443,32451,32459,32467,32475,32483,32491,32500,32508,32516,32524,32532,32540,32548,32556,32565,32573,32581,32589,32597,32605,32613,32622,32630,32638,32646,32654,32662,32670,32679,32687,32695,32703,32711,32719,32727,32736,32744,32752,32760, }; 

/* matched colorchecker_gainx2_15ms_01.raw12 (linearized and pattern noise corrected)
 * with ColorcheckerPassport NIKON.NEF (Nikon D800E) */
#define CAM_COLORMATRIX1                          \
   11038, 10000,    -3184, 10000,   -1009, 10000, \
   -3284, 10000,    11499, 10000,    1737, 10000, \
   -1283, 10000,     3550, 10000,    5967, 10000

int black_level = 0;
int white_level = 4095;
int image_width = 0;
int image_height = 0;
int swap_lines = 0;
int use_lut = 0;
int fixpn = 0;
int fixpn_flags1 = 0;
int fixpn_flags2 = 0;
int dump_regs = 0;

struct cmd_group options[] = {
    {
        "Options", (struct cmd_option[]) {
            { &black_level,    1, "--black=%d",    "Set black level (default 0)\n"
                             "                      - negative values allowed" },
            { &white_level,    1, "--white=%d",    "Set white level (default 4095)\n"
                             "                      - if too high, you may get pink highlights\n"
                             "                      - if too low, useful highlights may clip to white" },
            { &image_width,   1,  "--width=%d",    "Set image width (default 4096)"},
            { &image_height,   1, "--height=%d",   "Set image height\n"
                             "                      - default: autodetect from file size\n"
                             "                      - if input is stdin, default is 3072" },
            { &swap_lines,     1,  "--swap-lines", "Swap lines in the raw data\n"
                             "                      - workaround for an old Beta bug" },
            { &use_lut,        1,  "--lut",        "Linearize sensor response with per-channel LUTs\n"
                             "                      - probably correct only for one single camera :)" },
            { &fixpn,          1,  "--fixpn",      "Fix pattern noise (slow)" },
            OPTION_EOL,
        },
    },
    {
        "Debug options", (struct cmd_option[]) {
            { &dump_regs,      1,                   "--dump-regs",          "Dump sensor registers from the metadata block" },
            { &fixpn_flags1,   FIXPN_DBG_DENOISED,  "--fixpn-dbg-denoised", "Pattern noise: show denoised image" },
            { &fixpn_flags1,   FIXPN_DBG_NOISE,     "--fixpn-dbg-noise",    "Pattern noise: show noise image (original - denoised)" },
            { &fixpn_flags1,   FIXPN_DBG_MASK,      "--fixpn-dbg-mask",     "Pattern noise: show masked areas (edges and highlights)" },
            { &fixpn_flags2,   FIXPN_DBG_ROWNOISE,  "--fixpn-dbg-row",      "Pattern noise: debug rows (default: columns)" },
            OPTION_EOL,
        },
    },
    OPTION_GROUP_EOL
};

struct raw_info raw_info;

#define FAIL(fmt,...) { fprintf(stderr, "Error: "); fprintf(stderr, fmt, ## __VA_ARGS__); fprintf(stderr, "\n"); exit(1); }
#define CHECK(ok, fmt,...) { if (!ok) FAIL(fmt, ## __VA_ARGS__); }

#define MIN(a,b) \
   ({ __typeof__ ((a)+(b)) _a = (a); \
      __typeof__ ((a)+(b)) _b = (b); \
     _a < _b ? _a : _b; })

void raw_set_geometry(int width, int height, int skip_left, int skip_right, int skip_top, int skip_bottom)
{
    raw_info.width = width;
    raw_info.height = height;
    raw_info.pitch = raw_info.width * raw_info.bits_per_pixel / 8;
    raw_info.frame_size = raw_info.height * raw_info.pitch;
    raw_info.active_area.x1 = skip_left;
    raw_info.active_area.y1 = skip_top;
    raw_info.active_area.x2 = raw_info.width - skip_right;
    raw_info.active_area.y2 = raw_info.height - skip_bottom;
    raw_info.jpeg.x = 0;
    raw_info.jpeg.y = 0;
    raw_info.jpeg.width = raw_info.width - skip_left - skip_right;
    raw_info.jpeg.height = raw_info.height - skip_top - skip_bottom;
}

struct raw_info raw_info = {
    .api_version = 1,
    .bits_per_pixel = 12,
    .black_level = 0,
    .white_level = 4095,

    // The sensor bayer patterns are:
    //  0x02010100  0x01000201  0x01020001  0x00010102
    //      R G         G B         G R         B G
    //      G B         R G         B G         G R
    .cfa_pattern = 0x01000201,

    .calibration_illuminant1 = 1,       // Daylight
    .color_matrix1 = {CAM_COLORMATRIX1},// camera-specific, from dcraw.c
};

/* apply a constant offset to each raw12 pixel */
static void raw12_data_offset(void* buf, int frame_size, int offset)
{
    struct raw12_twopix * buf2 = (struct raw12_twopix *) buf;
    for (int i = 0; i < frame_size / sizeof(struct raw12_twopix); i ++)
    {
        unsigned a = (buf2[i].a_hi << 4) | buf2[i].a_lo;
        unsigned b = (buf2[i].b_hi << 8) | buf2[i].b_lo;
        
        a = MIN(a + offset, 4095);
        b = MIN(b + offset, 4095);
        
        buf2[i].a_lo = a; buf2[i].a_hi = a >> 4;
        buf2[i].b_lo = b; buf2[i].b_hi = b >> 8;
    }
}

/* unpack raw data from 12-bit to 16-bit */
/* this also promotes the data to 15-bit,
 * so we can use int16_t for processing */
static void unpack12(struct raw_info * raw_info, int16_t * raw16, int use_lut)
{
    /* we need this one for LUTs, since they assume black level is 0 */
    int black = raw_info->black_level;
    
    for (int y = 0; y < raw_info->height; y++)
    {
        for (int x = 0; x < raw_info->width; x += 2)
        {
            struct raw12_twopix * p = (struct raw12_twopix *)(raw_info->buffer + y * raw_info->pitch + x * sizeof(struct raw12_twopix) / 2);
            unsigned a = (p->a_hi << 4) | p->a_lo;
            unsigned b = (p->b_hi << 8) | p->b_lo;
            unsigned w = raw_info->width;
            if (use_lut)
            {
                /* Bayer pattern: [G2 B; R G1] */
                /* a and b can be either G2B (even lines) or RG1 (odd lines) */
                /* the LUTs already multiply the input values by 8 */
                raw16[x + y*w]     = (y % 2) ? Lut_R [a - black] : Lut_G2[a - black] + (black << 3);
                raw16[x + 1 + y*w] = (y % 2) ? Lut_G1[b - black] : Lut_B [b - black] + (black << 3);
            }
            else
            {
                raw16[x + y*w] = a << 3;
                raw16[x + 1 + y*w] = b << 3;
            }
        }
    }
}

/* pack raw data from 16-bit to 12-bit */
/* this also adds some anti-posterization noise,
 * which acts somewhat like introducing one extra bit of detail */
static void pack12(struct raw_info * raw_info, int16_t * buf)
{
    for (int y = 0; y < raw_info->height; y++)
    {
        for (int x = 0; x < raw_info->width; x += 2)
        {
            struct raw12_twopix * p = (struct raw12_twopix *)(raw_info->buffer + y * raw_info->pitch + x * sizeof(struct raw12_twopix) / 2);
            unsigned w = raw_info->width;
            unsigned a = ((MAX(buf[x + y*w],    0) >> 2) + rand()%2) >> 1;
            unsigned b = ((MAX(buf[x + 1 + y*w],0) >> 2) + rand()%2) >> 1;
            p->a_lo = a; p->a_hi = a >> 4;
            p->b_lo = b; p->b_hi = b >> 8;
        }
    }
}

/* todo: move this into FPGA */
void reverse_lines_order(char* buf, int count, int width)
{
    /* line width, in bytes */
    int pitch = width * 12 / 8;
    void* aux = malloc(pitch);
    CHECK(aux, "malloc");
    
    /* swap odd and even lines */
    int i;
    int height = count / pitch;
    for (i = 0; i < height; i += 2)
    {
        memcpy(aux, buf + i * pitch, pitch);
        memcpy(buf + i * pitch, buf + (i+1) * pitch, pitch);
        memcpy(buf + (i+1) * pitch, aux, pitch);
    }
    
    free(aux);
}

static int endswith(char* str, char* suffix)
{
    int l1 = strlen(str);
    int l2 = strlen(suffix);
    if (l1 < l2)
    {
        return 0;
    }
    if (strcmp(str + l1 - l2, suffix) == 0)
    {
        return 1;
    }
    return 0;
}

int main(int argc, char** argv)
{
    if (argc == 1)
    {
        printf("DNG converter for Apertus .raw12 files\n");
        printf("\n");
        printf("Usage:\n");
        printf("  %s input.raw12 [input2.raw12] [options]\n", argv[0]);
        printf("  cat input.raw12 | %s output.dng [options]\n", argv[0]);
        printf("\n");
        show_commandline_help(argv[0]);
        return 0;
    }

    /* parse all command-line options */
    for (int k = 1; k < argc; k++)
        if (argv[k][0] == '-')
            parse_commandline_option(argv[k]);
    show_active_options();

    /* all other arguments are input or output files */
    for (int k = 1; k < argc; k++)
    {
        if (argv[k][0] == '-')
            continue;
        
        FILE* fi;
        char* out_filename;

        printf("\n%s\n", argv[k]);
        
        if (endswith(argv[k], ".raw12"))
        {
            fi = fopen(argv[k], "rb");
            CHECK(fi, "could not open %s", argv[k]);

            /* replace input file extension with .DNG */
            static char fo[256];
            snprintf(fo, sizeof(fo), "%s", argv[k]);
            char* ext = strchr(fo, '.');
            if (!ext) ext = fo + strlen(fo) - 4;
            ext[0] = '.';
            ext[1] = 'D';
            ext[2] = 'N';
            ext[3] = 'G';
            ext[4] = '\0';
            out_filename = fo;
        }
        else if (endswith(argv[k], ".dng") || endswith(argv[k], ".DNG"))
        {
            fi = stdin;
            out_filename = argv[k];
            if (!image_height) image_height = 3072;
        }
        else
        {
            printf("Unknown file type.\n");
            continue;
        }
        
        int width = image_width ? image_width : 4096;
        int height = image_height;
        int has_metadata = 0;
        if (!height)
        {
            /* autodetect height from file size, if not specified in the command line */
            fseek(fi, 0, SEEK_END);
            height = ftell(fi) / (width * 12 / 8);
            has_metadata = (ftell(fi) - (width * height * 12 / 8) == 256);
            fseek(fi, 0, SEEK_SET);
        }
        raw_set_geometry(width, height, 0, 0, 0, 0);
        
        /* use black and white levels from command-line */
        raw_info.black_level = black_level;
        raw_info.white_level = white_level;
        
        /* print current settings */
        printf("Resolution  : %d x %d\n", raw_info.width, raw_info.height);
        printf("Frame size  : %d bytes\n", raw_info.frame_size);
        printf("Black level : %d\n", raw_info.black_level);
        printf("White level : %d\n", raw_info.white_level);
        switch(raw_info.cfa_pattern) {
            case 0x02010100:
                printf("Bayer Order : RGGB \n");    
                break;
            case 0x01000201:
                printf("Bayer Order : GBRG \n");    
                break;
            case 0x01020001:
                printf("Bayer Order : GRBG \n");    
                break;
            case 0x00010102:
                printf("Bayer Order : BGGR \n");    
                break;
        }


        /* load the raw data and convert it to DNG */
        char* raw = malloc(raw_info.frame_size);
        CHECK(raw, "malloc");
        
        int r = fread(raw, 1, raw_info.frame_size, fi);
        CHECK(r == raw_info.frame_size, "fread");
        raw_info.buffer = raw;
        
        if (raw_info.black_level < 0)
        {
            /* We can't use a negative black level,
             * but we may want to use one to fix green color cast in some images.
             * Workaround: add a constant offset to the raw data, and use black=0 in exif.
             */
            int offset = -raw_info.black_level;     /* positive number */
            printf("Raw offset  : %d\n", offset);
            raw12_data_offset(raw_info.buffer, raw_info.frame_size, offset);
            raw_info.black_level = 0;
            raw_info.white_level = MIN(raw_info.white_level + offset, 4095);
        }

        if (has_metadata)
        {
            uint16_t registers[128];
            int r = fread(registers, 1, 256, fi);
            CHECK(r == 256, "fread");
            extract_metadata(registers, dump_regs);
        }

        if (swap_lines)
        {
            printf("Line swap...\n");
            reverse_lines_order(raw_info.buffer, raw_info.frame_size, raw_info.width);
        }
        
        int16_t * raw16 = 0;
        
        if (use_lut || fixpn)
        {
            /* if we process the raw data, unpack it to int16_t (easier to work with) */
            /* this also multiplies the values by 8 and - optionally - applies LUTs */
            if (use_lut)
            {
                printf("Applying LUTs...\n");
            }
            raw16 = malloc(raw_info.width * raw_info.height * sizeof(raw16[0]));
            unpack12(&raw_info, raw16, use_lut);
        }
        
        if (fixpn)
        {
            int fixpn_flags = fixpn_flags1 | fixpn_flags2;
            fix_pattern_noise(&raw_info, raw16, fixpn_flags);
        }

        if (use_lut || fixpn)
        {
            /* processing done, repack the 16-bit data into 12-bit raw buffer */
            pack12(&raw_info, raw16);
            free(raw16); raw16 = 0;
        }
        
        /* save the DNG */
        printf("Output file : %s\n", out_filename);
        save_dng(out_filename, &raw_info);
        fclose(fi);
        
        free(raw); raw_info.buffer = 0;
    }

    printf("Done.\n");
    
    return 0;
}

int raw_get_pixel(int x, int y)
{
    /* fixme: return valid values here to create a thumbnail */
    return 0;
}
